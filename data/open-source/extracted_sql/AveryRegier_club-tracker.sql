CREATE TABLE ${schema}.club ( id uuid ${generate_uuid} PRIMARY KEY, parent_club_id uuid REFERENCES ${schema}.club, curriculum VARCHAR(20))
CREATE TABLE ${schema}.family_registration ( family_id ${uuid} REFERENCES ${schema}.family, input_field_id ${uuid} REFERENCES input_field, the_value VARCHAR(5000), PRIMARY KEY(family_id, input_field_id))
CREATE TABLE ${schema}.family ( id uuid ${generate_uuid} PRIMARY KEY)
CREATE TABLE ${schema}.address ( id ${uuid} ${generate_uuid} PRIMARY KEY, line1 VARCHAR(200), line2 VARCHAR(200), city VARCHAR(100), territory VARCHAR(100), postal_code VARCHAR(20), country VARCHAR(3))
CREATE TABLE ${schema}.club ( id ${uuid} ${generate_uuid} PRIMARY KEY, parent_club_id ${uuid}, curriculum VARCHAR(20), FOREIGN KEY (parent_club_id) REFERENCES ${schema}.club(id))
CREATE TABLE ${schema}.family ( id ${uuid} ${generate_uuid} PRIMARY KEY, address_id ${uuid}, FOREIGN KEY (address_id) REFERENCES ${schema}.address(id))
CREATE TABLE ${schema}.input_field_value ( parent_input_field_id ${uuid}, the_order integer NOT NULL, name VARCHAR(25) NOT NULL, the_value VARCHAR(10) NOT NULL, is_default CHAR(1) NOT NULL, PRIMARY KEY(parent_input_field_id, the_order), FOREIGN KEY (parent_input_field_id) REFERENCES ${schema}.input_field(id))
CREATE TABLE ${schema}.listener ( id ${uuid} REFERENCES ${schema}.person NOT NULL, club_id ${uuid} REFERENCES ${schema}.club NOT NULL, PRIMARY KEY(id, club_id))
CREATE TABLE ${schema}.invite ( id ${uuid} REFERENCES ${schema}.person NOT NULL, auth INTEGER NOT NULL, sent TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, invited_by ${uuid} REFERENCES ${schema}.person NOT NULL, completed TIMESTAMP, PRIMARY KEY(id, auth))
CREATE TABLE ${schema}.organization ( id ${uuid} ${generate_uuid} PRIMARY KEY, organizationName VARCHAR(50) NOT NULL, locale VARCHAR(10), club_id ${uuid}, FOREIGN KEY (club_id) REFERENCES ${schema}.club(id))
CREATE TABLE ${schema}.input_group ( id ${uuid} ${generate_uuid} PRIMARY KEY, parent_input_group_id ${uuid} REFERENCES ${schema}.input_group, name VARCHAR(25), the_order integer NOT NULL)
CREATE TABLE ${schema}.leader ( id ${uuid} NOT NULL, club_id ${uuid}, role VARCHAR(10) NOT NULL, PRIMARY KEY(id, club_id), FOREIGN KEY (id) REFERENCES ${schema}.person(id), FOREIGN KEY (club_id) REFERENCES ${schema}.club(id))
CREATE TABLE ${schema}.club ( id ${uuid} ${generate_uuid} PRIMARY KEY, parent_club_id ${uuid} REFERENCES ${schema}.club, curriculum VARCHAR(20))
CREATE TABLE ${schema}.clubber ( id uuid REFERENCES ${schema}.person NOT NULL PRIMARY KEY, family_id uuid REFERENCES ${schema}.family, club_id uuid REFERENCES ${schema}.club, age_group VARCHAR(20) NOT NULL)
CREATE TABLE ${schema}.award ( id ${uuid} ${generate_uuid} PRIMARY KEY, clubber_id ${uuid} NOT NULL, section_id VARCHAR(100) NOT NULL, accomplishment VARCHAR(100), token VARCHAR(100), presented_at ${uuid}, FOREIGN KEY (clubber_id, section_id) REFERENCES ${schema}.record (clubber_id, section_id), FOREIGN KEY (presented_at) REFERENCES ${schema}.ceremony(id))
CREATE TABLE ${schema}.award ( id ${uuid} ${generate_uuid} PRIMARY KEY, clubber_id ${uuid} NOT NULL, section_id VARCHAR(100) NOT NULL, accomplishment VARCHAR(100), token VARCHAR(100), presented_at ${uuid} REFERENCES ${schema}.ceremony, FOREIGN KEY (clubber_id, section_id) REFERENCES ${schema}.record (clubber_id, section_id))
CREATE TABLE ${schema}.input_field_value ( parent_input_field_id ${uuid} REFERENCES ${schema}.input_field, the_order integer NOT NULL, name VARCHAR(25) NOT NULL, the_value VARCHAR(10) NOT NULL, is_default CHAR(1) NOT NULL, PRIMARY KEY(parent_input_field_id, the_order))
CREATE TABLE ${schema}.login ( id ${uuid} NOT NULL, provider_id VARCHAR(20) NOT NULL, unique_id VARCHAR(500) NOT NULL, auth INTEGER, PRIMARY KEY(id, provider_id, unique_id), FOREIGN KEY (id) REFERENCES ${schema}.person(id), FOREIGN KEY (provider_id) REFERENCES ${schema}.provider(provider_id))
CREATE TABLE ${schema}.organization ( id ${uuid} ${generate_uuid} PRIMARY KEY, organizationName VARCHAR(50) NOT NULL, locale VARCHAR(10), club_id ${uuid} REFERENCES ${schema}.club)
CREATE TABLE ${schema}.clubber ( id ${uuid} NOT NULL PRIMARY KEY, family_id ${uuid}, club_id ${uuid}, age_group VARCHAR(20) NOT NULL, FOREIGN KEY (id) REFERENCES ${schema}.person(id), FOREIGN KEY (family_id) REFERENCES ${schema}.family(id), FOREIGN KEY (club_id) REFERENCES ${schema}.club(id))
CREATE TABLE ${schema}.record ( clubber_id ${uuid} REFERENCES ${schema}.person NOT NULL, club_id ${uuid} REFERENCES ${schema}.club, section_id VARCHAR(100) NOT NULL, signed_by ${uuid}, sign_date DATE, note VARCHAR(1000), PRIMARY KEY(clubber_id, section_id), FOREIGN KEY(signed_by, club_id) REFERENCES ${schema}.listener (id, club_id))
CREATE TABLE ${schema}.input_field ( id ${uuid} ${generate_uuid} PRIMARY KEY, parent_input_group_id ${uuid} REFERENCES ${schema}.input_group, name VARCHAR(100) NOT NULL, type VARCHAR(10) NOT NULL, required CHAR(1) NOT NULL, the_order integer NOT NULL)
CREATE TABLE ${schema}.award ( id uuid ${generate_uuid} PRIMARY KEY, clubber_id uuid NOT NULL, section_id VARCHAR(100) NOT NULL, accomplishment VARCHAR(100), token VARCHAR(100), presented_at uuid REFERENCES ${schema}.ceremony, FOREIGN KEY (clubber_id, section_id) REFERENCES ${schema}.record (clubber_id, section_id))
CREATE TABLE ${schema}.login ( id ${uuid} REFERENCES ${schema}.person NOT NULL, provider_id VARCHAR(20) REFERENCES ${schema}.provider NOT NULL, unique_id VARCHAR(500) NOT NULL, auth INTEGER, PRIMARY KEY(id, provider_id, unique_id))
CREATE TABLE ${schema}.registration_form ( organization_id ${uuid}, type VARCHAR(10), input_group_id ${uuid}, PRIMARY KEY(organization_id, type), FOREIGN KEY (organization_id) REFERENCES ${schema}.organization(id), FOREIGN KEY (input_group_id) REFERENCES ${schema}.input_group(id))
CREATE TABLE ${schema}.registration_form ( organization_id ${uuid} REFERENCES ${schema}.organization, type VARCHAR(10), input_group_id ${uuid} REFERENCES ${schema}.input_group, PRIMARY KEY(organization_id, type))
CREATE TABLE ${schema}.family ( id ${uuid} ${generate_uuid} PRIMARY KEY, address_id ${uuid} REFERENCES ${schema}.address)
CREATE TABLE ${schema}.parent ( id ${uuid} NOT NULL PRIMARY KEY, family_id ${uuid} NOT NULL, FOREIGN KEY (id) REFERENCES ${schema}.person(id), FOREIGN KEY (family_id) REFERENCES ${schema}.family(id))
CREATE TABLE ${schema}.person ( id ${uuid} ${generate_uuid} PRIMARY KEY, title VARCHAR(10), given VARCHAR(25), surname VARCHAR(50), honorific VARCHAR(10), friendly VARCHAR(25), gender CHAR(1), email VARCHAR(150))
CREATE TABLE ${schema}.ceremony ( id ${uuid} ${generate_uuid} PRIMARY KEY, name VARCHAR(100), presentation_date DATE)
CREATE TABLE ${schema}.listener ( id ${uuid} NOT NULL, club_id ${uuid} NOT NULL, PRIMARY KEY(id, club_id), FOREIGN KEY (id) REFERENCES ${schema}.person(id), FOREIGN KEY (club_id) REFERENCES ${schema}.club(id))
CREATE TABLE ${schema}.ceremony ( id uuid ${generate_uuid} PRIMARY KEY, name VARCHAR(100), presentation_date DATE)
CREATE TABLE ${schema}.provider ( provider_id VARCHAR(20) PRIMARY KEY, site VARCHAR(100) NOT NULL, name VARCHAR(100) NOT NULL, image VARCHAR(250) NOT NULL, client_key VARCHAR(500) NOT NULL, secret VARCHAR(500) NOT NULL)
CREATE TABLE ${schema}.leader ( id uuid REFERENCES ${schema}.person NOT NULL, club_id uuid REFERENCES ${schema}.club, role VARCHAR(10) NOT NULL, PRIMARY KEY(id, club_id))
CREATE TABLE ${schema}.input_field ( id ${uuid} ${generate_uuid} PRIMARY KEY, parent_input_group_id ${uuid}, name VARCHAR(100) NOT NULL, type VARCHAR(10) NOT NULL, required CHAR(1) NOT NULL, the_order integer NOT NULL, FOREIGN KEY (parent_input_group_id) REFERENCES ${schema}.input_group(id))
CREATE TABLE ${schema}.leader ( id ${uuid} REFERENCES ${schema}.person NOT NULL, club_id ${uuid} REFERENCES ${schema}.club, role VARCHAR(10) NOT NULL, PRIMARY KEY(id, club_id))
CREATE TABLE ${schema}.record ( clubber_id uuid REFERENCES ${schema}.person NOT NULL, club_id uuid REFERENCES ${schema}.club, section_id VARCHAR(100) NOT NULL, signed_by uuid, sign_date DATE, note VARCHAR(1000), PRIMARY KEY(clubber_id, section_id), FOREIGN KEY(signed_by, club_id) REFERENCES ${schema}.listener (id, club_id))
CREATE TABLE ${schema}.family_registration ( family_id ${uuid}, input_field_id ${uuid}, the_value VARCHAR(5000), PRIMARY KEY(family_id, input_field_id), FOREIGN KEY (family_id) REFERENCES ${schema}.family(id), FOREIGN KEY (input_field_id) REFERENCES ${schema}.input_field(id))
CREATE TABLE ${schema}.listener ( id uuid REFERENCES ${schema}.person NOT NULL, club_id uuid REFERENCES ${schema}.club NOT NULL, PRIMARY KEY(id, club_id))
CREATE TABLE ${schema}.organization ( id uuid ${generate_uuid} PRIMARY KEY, organizationName VARCHAR(50) NOT NULL, locale VARCHAR(10), club_id uuid REFERENCES ${schema}.club)
CREATE TABLE ${schema}.person ( id uuid ${generate_uuid} PRIMARY KEY, title VARCHAR(10), given VARCHAR(25), surname VARCHAR(50), honorific VARCHAR(10), friendly VARCHAR(25), gender CHAR(1), email VARCHAR(150))
CREATE TABLE ${schema}.input_group ( id ${uuid} ${generate_uuid} PRIMARY KEY, parent_input_group_id ${uuid}, name VARCHAR(25), the_order integer NOT NULL, FOREIGN KEY (parent_input_group_id) REFERENCES ${schema}.input_group(id))
CREATE TABLE ${schema}.login ( id uuid REFERENCES ${schema}.person NOT NULL, provider_id VARCHAR(20) REFERENCES ${schema}.provider NOT NULL, unique_id VARCHAR(500) NOT NULL, auth INTEGER, PRIMARY KEY(id, provider_id, unique_id))
CREATE TABLE ${schema}.person_registration ( person_id ${uuid}, input_field_id ${uuid}, the_value VARCHAR(5000), PRIMARY KEY(person_id, input_field_id), FOREIGN KEY (person_id) REFERENCES ${schema}.person(id), FOREIGN KEY (input_field_id) REFERENCES ${schema}.input_field(id))
CREATE TABLE ${schema}.person_registration ( person_id ${uuid} REFERENCES ${schema}.person, input_field_id ${uuid} REFERENCES input_field, the_value VARCHAR(5000), PRIMARY KEY(person_id, input_field_id))
CREATE TABLE ${schema}.parent ( id ${uuid} REFERENCES ${schema}.person NOT NULL PRIMARY KEY, family_id ${uuid} REFERENCES ${schema}.family (id) NOT NULL)
CREATE TABLE ${schema}.record ( clubber_id ${uuid} NOT NULL, club_id ${uuid}, section_id VARCHAR(100) NOT NULL, signed_by ${uuid}, sign_date DATE, note VARCHAR(1000), PRIMARY KEY(clubber_id, section_id), FOREIGN KEY(signed_by, club_id) REFERENCES ${schema}.listener (id, club_id), FOREIGN KEY (clubber_id) REFERENCES ${schema}.person(id), FOREIGN KEY (club_id) REFERENCES ${schema}.club(id))
CREATE TABLE ${schema}.invite ( id ${uuid} NOT NULL, auth INTEGER NOT NULL, sent TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, invited_by ${uuid} NOT NULL, completed TIMESTAMP, PRIMARY KEY(id, auth), FOREIGN KEY (id) REFERENCES ${schema}.person(id), FOREIGN KEY (invited_by) REFERENCES ${schema}.person(id))
CREATE TABLE ${schema}.clubber ( id ${uuid} REFERENCES ${schema}.person NOT NULL PRIMARY KEY, family_id ${uuid} REFERENCES ${schema}.family, club_id ${uuid} REFERENCES ${schema}.club, age_group VARCHAR(20) NOT NULL)
CREATE TABLE ${schema}.parent ( id uuid REFERENCES ${schema}.person NOT NULL PRIMARY KEY, family_id uuid REFERENCES ${schema}.family (id) NOT NULL)
