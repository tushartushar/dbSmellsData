CREATE TABLE v_user_balance ( user_id tinyint NOT NULL, total tinyint NOT NULL, nb tinyint NOT NULL)
CREATE TABLE IF NOT EXISTS `fablab`.`v_user_balance_all` (`user_id` INT, `total` INT)
SELECT machine_id, name, machine_type_id FROM fablab_old.t_machine;
SELECT 10, group_id FROM fablab_old.t_group WHERE technicalname='comite');
SELECT role_id FROM t_role WHERE technicalname = 'ROLE_ASSET_UPLOAD'), (SELECT group_id FROM t_group WHERE technicalname='animator');
SELECT 3, group_id FROM fablab_old.t_group WHERE technicalname='comite');
CREATE TABLE t_subscription ( subscription_id int(11) NOT NULL AUTO_INCREMENT COMMENT 'Is like a usage. User has to pay for it', user_id int(11) NOT NULL, membership_type_id int(11) NOT NULL, date_subscription datetime NOT NULL, price double NOT NULL, duration int(11) NOT NULL, comment varchar(255) DEFAULT NULL, PRIMARY KEY (subscription_id), KEY fk_t_membership_t_users1_idx (user_id), KEY fk_t_subscription_t_membership_type1_idx (membership_type_id), CONSTRAINT fk_t_membership_t_users1 FOREIGN KEY (user_id) REFERENCES t_user (user_id) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT fk_t_subscription_t_membership_type1 FOREIGN KEY (membership_type_id) REFERENCES t_membership_type (membership_type_id) ON DELETE NO ACTION ON UPDATE NO ACTION)
CREATE TABLE v_group_user ( email tinyint NOT NULL, group_id tinyint NOT NULL, user_id tinyint NOT NULL, technicalname tinyint NOT NULL)
CREATE TABLE t_machine ( machine_id int(11) NOT NULL AUTO_INCREMENT, name varchar(45) NOT NULL, machine_type_id int(11) NOT NULL, PRIMARY KEY (machine_id), KEY fk_t_machines_t_machine_type1_idx (machine_type_id), CONSTRAINT fk_t_machines_t_machine_type1 FOREIGN KEY (machine_type_id) REFERENCES t_machine_type (machine_type_id) ON DELETE NO ACTION ON UPDATE NO ACTION)
CREATE TABLE r_group_user ( group_id int(11) NOT NULL, user_id int(11) NOT NULL, PRIMARY KEY (group_id,user_id), KEY fk_t_groups_has_t_users_t_groups1_idx (group_id), KEY fk_r_group_user_t_user1_idx (user_id), CONSTRAINT fk_r_group_user_t_user1 FOREIGN KEY (user_id) REFERENCES t_user (user_id) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT fk_t_groups_has_t_users_t_groups1 FOREIGN KEY (group_id) REFERENCES t_group (group_id) ON DELETE NO ACTION ON UPDATE NO ACTION)
CREATE TABLE t_membership_type ( membership_type_id int(11) NOT NULL AUTO_INCREMENT, name varchar(45) NOT NULL, duration int(11) NOT NULL, price double NOT NULL, PRIMARY KEY (membership_type_id), UNIQUE KEY name_UNIQUE (name))
CREATE TABLE IF NOT EXISTS `fablab`.`r_user_authorized_machine_type` ( `user_id` INT NOT NULL, `machine_type_id` INT NOT NULL, `formation_date` DATE NOT NULL, PRIMARY KEY (`user_id`, `machine_type_id`), INDEX `fk_t_user_has_t_machine_type_t_machine_type1_idx` (`machine_type_id` ASC), INDEX `fk_t_user_has_t_machine_type_t_user1_idx` (`user_id` ASC), CONSTRAINT `fk_t_user_has_t_machine_type_t_user1` FOREIGN KEY (`user_id`) REFERENCES `fablab`.`t_user` (`user_id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_t_user_has_t_machine_type_t_machine_type1` FOREIGN KEY (`machine_type_id`) REFERENCES `fablab`.`t_machine_type` (`machine_type_id`) ON DELETE NO ACTION ON UPDATE NO ACTION)
CREATE TABLE IF NOT EXISTS `fablab`.`t_subscription` ( `subscription_id` INT NOT NULL AUTO_INCREMENT COMMENT 'Is like a usage. User has to pay for it', `user_id` INT NOT NULL, `membership_type_id` INT NOT NULL, `date_subscription` DATETIME NOT NULL, `price` DOUBLE NOT NULL, `duration` INT NOT NULL, `comment` VARCHAR(255) NULL, PRIMARY KEY (`subscription_id`), INDEX `fk_t_membership_t_users1_idx` (`user_id` ASC), INDEX `fk_t_subscription_t_membership_type1_idx` (`membership_type_id` ASC), CONSTRAINT `fk_t_membership_t_users1` FOREIGN KEY (`user_id`) REFERENCES `fablab`.`t_user` (`user_id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_t_subscription_t_membership_type1` FOREIGN KEY (`membership_type_id`) REFERENCES `fablab`.`t_membership_type` (`membership_type_id`) ON DELETE NO ACTION ON UPDATE NO ACTION)
SELECT 2, group_id FROM fablab_old.t_group WHERE technicalname='animator');
SELECT 11, group_id FROM fablab_old.t_group WHERE technicalname='animator');
CREATE TABLE IF NOT EXISTS `fablab`.`t_membership_type` ( `membership_type_id` INT NOT NULL AUTO_INCREMENT, `name` VARCHAR(45) NOT NULL, `duration` INT NOT NULL, `price` DOUBLE NOT NULL, PRIMARY KEY (`membership_type_id`), UNIQUE INDEX `name_UNIQUE` (`name` ASC))
SELECT role_id FROM t_role WHERE technicalname = 'ROLE_PROJECT_CREATE'), (SELECT group_id FROM t_group WHERE technicalname='member');
SELECT 14, group_id FROM fablab_old.t_group WHERE technicalname='comite');
SELECT role_id FROM t_role WHERE technicalname = 'ROLE_ASSET_UPLOAD'), (SELECT group_id FROM t_group WHERE technicalname='comite');
CREATE TABLE t_group ( group_id int(11) NOT NULL AUTO_INCREMENT, technicalname varchar(45) NOT NULL, name varchar(45) NOT NULL, PRIMARY KEY (group_id))
CREATE TABLE IF NOT EXISTS `fablab`.`t_machine_type` ( `machine_type_id` INT NOT NULL AUTO_INCREMENT, `technicalname` VARCHAR(45) NOT NULL, `name` VARCHAR(45) NOT NULL, `restricted` TINYINT(1) NOT NULL, PRIMARY KEY (`machine_type_id`))
SELECT role_id FROM t_role WHERE technicalname = 'ROLE_PROJECT_CREATE'), (SELECT group_id FROM t_group WHERE technicalname='animator');
CREATE TABLE IF NOT EXISTS `fablab`.`v_user_balance_grouped` (`user_id` INT, `balance` INT)
SELECT 7, group_id FROM fablab_old.t_group WHERE technicalname='animator');
SELECT 4, group_id FROM fablab_old.t_group WHERE technicalname='animator');
CREATE TABLE IF NOT EXISTS `fablab`.`t_configuration` ( `id` INT NOT NULL AUTO_INCREMENT, `conf_key` VARCHAR(45) NOT NULL, `conf_value` VARCHAR(45) NULL, PRIMARY KEY (`id`), UNIQUE INDEX `conf_key_UNIQUE` (`conf_key` ASC))
SELECT 12, group_id FROM fablab_old.t_group WHERE technicalname='animator');
CREATE TABLE t_configuration ( id int(11) NOT NULL AUTO_INCREMENT, conf_key varchar(45) NOT NULL, conf_value varchar(45) DEFAULT NULL, PRIMARY KEY (id), UNIQUE KEY conf_key_UNIQUE (conf_key))
CREATE TABLE r_project_user (	project_id INT(11) NOT NULL,	user_id INT(11) NOT NULL,	can_edit TINYINT(1) NOT NULL,	role VARCHAR(45) NULL DEFAULT NULL,	PRIMARY KEY (project_id, user_id),	INDEX fk_t_project_has_t_user_t_user1_idx (user_id ASC),	INDEX fk_t_project_has_t_user_t_project1_idx (project_id ASC),	CONSTRAINT fk_t_project_has_t_user_t_project1	FOREIGN KEY (project_id)	REFERENCES t_project (project_id)		ON DELETE NO ACTION		ON UPDATE NO ACTION,	CONSTRAINT fk_t_project_has_t_user_t_user1	FOREIGN KEY (user_id)	REFERENCES t_user (user_id)		ON DELETE NO ACTION		ON UPDATE NO ACTION)
SELECT 9, group_id FROM fablab_old.t_group WHERE technicalname='comite');
CREATE TABLE v_user_balance_subscription ( firstname tinyint NOT NULL, lastname tinyint NOT NULL, user_id tinyint NOT NULL, total tinyint NOT NULL)
CREATE TABLE t_project (	project_id INT(11) NOT NULL AUTO_INCREMENT,	title VARCHAR(255) NOT NULL,	introduction VARCHAR(255) NULL DEFAULT NULL,	description LONGTEXT NOT NULL,	state VARCHAR(45) NOT NULL,	date_start DATETIME NOT NULL,	date_end DATETIME NULL DEFAULT NULL,	image_url VARCHAR(255) NULL DEFAULT NULL,	PRIMARY KEY (project_id))
SELECT price_revision_id FROM fablab_old.t_price_revision WHERE pr.price_revision_id=s.price_revision_id);
SELECT 11, group_id FROM fablab_old.t_group WHERE technicalname='comite');
CREATE TABLE t_machine_type ( machine_type_id int(11) NOT NULL AUTO_INCREMENT, technicalname varchar(45) NOT NULL, name varchar(45) NOT NULL, restricted tinyint(1) NOT NULL, PRIMARY KEY (machine_type_id))
SELECT 3, group_id FROM fablab_old.t_group WHERE technicalname='animator');
CREATE TABLE r_user_authorized_machine_type ( user_id int(11) NOT NULL, machine_type_id int(11) NOT NULL, formation_date date NOT NULL, PRIMARY KEY (user_id,machine_type_id), KEY fk_t_user_has_t_machine_type_t_machine_type1_idx (machine_type_id), KEY fk_t_user_has_t_machine_type_t_user1_idx (user_id), CONSTRAINT fk_t_user_has_t_machine_type_t_machine_type1 FOREIGN KEY (machine_type_id) REFERENCES t_machine_type (machine_type_id) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT fk_t_user_has_t_machine_type_t_user1 FOREIGN KEY (user_id) REFERENCES t_user (user_id) ON DELETE NO ACTION ON UPDATE NO ACTION)
SELECT 12, group_id FROM fablab_old.t_group WHERE technicalname='comite');
SELECT user_id, machine_type_id, formation_date FROM fablab_old.r_user_authorized_machine_type;
CREATE TABLE IF NOT EXISTS `fablab`.`r_group_role` ( `role_id` INT NOT NULL, `group_id` INT NOT NULL, PRIMARY KEY (`role_id`, `group_id`), INDEX `fk_t_roles_has_t_group_t_group1_idx` (`group_id` ASC), INDEX `fk_t_roles_has_t_group_t_roles1_idx` (`role_id` ASC), CONSTRAINT `fk_t_roles_has_t_group_t_roles1` FOREIGN KEY (`role_id`) REFERENCES `fablab`.`t_role` (`role_id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_t_roles_has_t_group_t_group1` FOREIGN KEY (`group_id`) REFERENCES `fablab`.`t_group` (`group_id`) ON DELETE NO ACTION ON UPDATE NO ACTION)
CREATE TABLE r_price_machine ( machine_type_id int(11) NOT NULL, membership_type_id int(11) NOT NULL, price float NOT NULL, PRIMARY KEY (machine_type_id,membership_type_id), KEY fk_r_price_t_machine_type1_idx (machine_type_id), KEY fk_r_price_t_membership_type1_idx (membership_type_id), CONSTRAINT fk_r_price_t_machine_type1 FOREIGN KEY (machine_type_id) REFERENCES t_machine_type (machine_type_id) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT fk_r_price_t_membership_type1 FOREIGN KEY (membership_type_id) REFERENCES t_membership_type (membership_type_id) ON DELETE NO ACTION ON UPDATE NO ACTION)
CREATE TABLE t_usage ( usage_id int(11) NOT NULL AUTO_INCREMENT, date_start datetime NOT NULL, price_hour double NOT NULL DEFAULT '-1', minutes int(11) NOT NULL, additional_cost float NOT NULL, user_id int(11) NOT NULL, machine_id int(11) NOT NULL, membership_type_id int(11) NOT NULL, comment varchar(255) DEFAULT NULL, PRIMARY KEY (usage_id), KEY fk_t_utilisations_t_users1_idx (user_id), KEY fk_t_utilisations_t_machines1_idx (machine_id), KEY fk_t_usages_t_membership_type1_idx (membership_type_id), CONSTRAINT fk_t_usages_t_membership_type1 FOREIGN KEY (membership_type_id) REFERENCES t_membership_type (membership_type_id) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT fk_t_utilisations_t_machines1 FOREIGN KEY (machine_id) REFERENCES t_machine (machine_id) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT fk_t_utilisations_t_users1 FOREIGN KEY (user_id) REFERENCES t_user (user_id) ON DELETE NO ACTION ON UPDATE NO ACTION)
SELECT payment_id, total, date_payement, user_id, cashier_id, comment FROM fablab_old.t_payment;
CREATE TABLE v_user_balance_all ( user_id tinyint NOT NULL, total tinyint NOT NULL)
SELECT 7, group_id FROM fablab_old.t_group WHERE technicalname='comite');
CREATE TABLE t_user ( user_id int(11) NOT NULL AUTO_INCREMENT, membership_type_id int(11) NOT NULL, password varchar(64) DEFAULT NULL, password_salt varchar(45) DEFAULT 'fablab', firstname varchar(45) NOT NULL, lastname varchar(45) NOT NULL, email varchar(100) NOT NULL DEFAULT 'nomail', date_inscr datetime NOT NULL, balance float NOT NULL DEFAULT '0', rfid char(16) DEFAULT NULL, enabled tinyint(1) NOT NULL DEFAULT '1', phone varchar(45) DEFAULT NULL, address varchar(200) DEFAULT NULL, birthdate date DEFAULT NULL, gender tinyint(4) DEFAULT NULL, comment text, PRIMARY KEY (user_id), UNIQUE KEY email_UNIQUE (email), UNIQUE KEY rfid_UNIQUE (rfid), KEY fk_t_users_t_membership_type1_idx (membership_type_id), CONSTRAINT fk_t_users_t_membership_type1 FOREIGN KEY (membership_type_id) REFERENCES t_membership_type (membership_type_id) ON DELETE NO ACTION ON UPDATE NO ACTION)
CREATE TABLE IF NOT EXISTS `fablab`.`v_user_balance_subscription` (`firstname` INT, `lastname` INT, `user_id` INT, `total` INT)
CREATE TABLE IF NOT EXISTS `fablab`.`r_group_user` ( `group_id` INT NOT NULL, `user_id` INT NOT NULL, PRIMARY KEY (`group_id`, `user_id`), INDEX `fk_t_groups_has_t_users_t_groups1_idx` (`group_id` ASC), INDEX `fk_r_group_user_t_user1_idx` (`user_id` ASC), CONSTRAINT `fk_t_groups_has_t_users_t_groups1` FOREIGN KEY (`group_id`) REFERENCES `fablab`.`t_group` (`group_id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_r_group_user_t_user1` FOREIGN KEY (`user_id`) REFERENCES `fablab`.`t_user` (`user_id`) ON DELETE NO ACTION ON UPDATE NO ACTION)
SELECT 2, group_id FROM fablab_old.t_group WHERE technicalname='comite');
SELECT audit_id, who, action, object, object_id, dateandtime, success, content, detail FROM fablab_old.t_audit;
CREATE TABLE IF NOT EXISTS `fablab`.`t_user` ( `user_id` INT NOT NULL AUTO_INCREMENT, `membership_type_id` INT NOT NULL, `password` VARCHAR(64) NULL, `password_salt` VARCHAR(45) NULL DEFAULT 'fablab', `firstname` VARCHAR(45) NOT NULL, `lastname` VARCHAR(45) NOT NULL, `email` VARCHAR(100) NOT NULL DEFAULT 'nomail', `date_inscr` DATETIME NOT NULL, `balance` FLOAT NOT NULL DEFAULT 0, `rfid` CHAR(16) NULL, `enabled` TINYINT(1) NOT NULL DEFAULT 1, `phone` VARCHAR(45) NULL, `address` VARCHAR(200) NULL, `birthdate` DATE NULL, `gender` TINYINT NULL, `comment` TEXT NULL, PRIMARY KEY (`user_id`), UNIQUE INDEX `rfid_UNIQUE` (`rfid` ASC), INDEX `fk_t_users_t_membership_type1_idx` (`membership_type_id` ASC), UNIQUE INDEX `email_UNIQUE` (`email` ASC), CONSTRAINT `fk_t_users_t_membership_type1` FOREIGN KEY (`membership_type_id`) REFERENCES `fablab`.`t_membership_type` (`membership_type_id`) ON DELETE NO ACTION ON UPDATE NO ACTION)
CREATE TABLE IF NOT EXISTS `fablab`.`v_user_balance_payment` (`firstname` INT, `lastname` INT, `user_id` INT, `total` INT)
SELECT group_id, technicalname, name FROM fablab_old.t_group;
SELECT 5, group_id FROM fablab_old.t_group WHERE technicalname='comite');
CREATE TABLE IF NOT EXISTS `fablab`.`v_user_balance` (`user_id` INT, `total` INT, `nb` INT)
CREATE TABLE IF NOT EXISTS `fablab`.`t_group` ( `group_id` INT NOT NULL AUTO_INCREMENT, `technicalname` VARCHAR(45) NOT NULL, `name` VARCHAR(45) NOT NULL, PRIMARY KEY (`group_id`))
CREATE TABLE t_asset (	asset_id INT(11) NOT NULL AUTO_INCREMENT,	title VARCHAR(255) NULL DEFAULT NULL,	asset_data MEDIUMBLOB NOT NULL,	mime VARCHAR(45) NOT NULL,	owner_id INT(11) NOT NULL,	date_upload DATETIME NOT NULL,	data_size INT(11) NOT NULL,	extension VARCHAR(6) NOT NULL,	PRIMARY KEY (asset_id),	INDEX fk_t_asset_t_user1_idx (owner_id ASC),	CONSTRAINT fk_t_asset_t_user1	FOREIGN KEY (owner_id)	REFERENCES t_user (user_id)		ON DELETE NO ACTION		ON UPDATE NO ACTION)
SELECT group_id, user_id FROM fablab_old.r_group_user;
SELECT role_id FROM t_role WHERE technicalname = 'ROLE_PROJECT_MANAGE'), (SELECT group_id FROM t_group WHERE technicalname='comite');
CREATE TABLE v_user_balance_usage ( firstname tinyint NOT NULL, lastname tinyint NOT NULL, user_id tinyint NOT NULL, total tinyint NOT NULL)
SELECT role_id FROM t_role WHERE technicalname = 'ROLE_ASSET_MANAGE'), (SELECT group_id FROM t_group WHERE technicalname='animator');
CREATE TABLE IF NOT EXISTS `fablab`.`v_user_balance_usage` (`firstname` INT, `lastname` INT, `user_id` INT, `total` INT)
SELECT 11, group_id FROM fablab_old.t_group WHERE technicalname='member');
SELECT 4, group_id FROM fablab_old.t_group WHERE technicalname='member');
SELECT 8, group_id FROM fablab_old.t_group WHERE technicalname='comite');
SELECT 6, group_id FROM fablab_old.t_group WHERE technicalname='animator');
UPDATE t_user SET login=CONCATWHERE user_id!=0
SELECT 4, group_id FROM fablab_old.t_group WHERE technicalname='comite');
CREATE TABLE r_group_role ( role_id int(11) NOT NULL, group_id int(11) NOT NULL, PRIMARY KEY (role_id,group_id), KEY fk_t_roles_has_t_group_t_group1_idx (group_id), KEY fk_t_roles_has_t_group_t_roles1_idx (role_id), CONSTRAINT fk_t_roles_has_t_group_t_group1 FOREIGN KEY (group_id) REFERENCES t_group (group_id) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT fk_t_roles_has_t_group_t_roles1 FOREIGN KEY (role_id) REFERENCES t_role (role_id) ON DELETE NO ACTION ON UPDATE NO ACTION)
SELECT role_id FROM t_role WHERE technicalname = 'ROLE_PROJECT_MANAGE'), (SELECT group_id FROM t_group WHERE technicalname='animator');
CREATE TABLE IF NOT EXISTS `fablab`.`t_payment` ( `payment_id` INT NOT NULL AUTO_INCREMENT, `total` FLOAT NOT NULL, `date_payement` DATETIME NOT NULL, `user_id` INT NOT NULL, `cashier_id` INT NOT NULL, `comment` VARCHAR(255) NULL, PRIMARY KEY (`payment_id`), INDEX `fk_t_payment_t_users2_idx` (`user_id` ASC), INDEX `fk_t_payment_t_users1_idx` (`cashier_id` ASC), CONSTRAINT `fk_t_payment_t_users2` FOREIGN KEY (`user_id`) REFERENCES `fablab`.`t_user` (`user_id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_t_payment_t_users1` FOREIGN KEY (`cashier_id`) REFERENCES `fablab`.`t_user` (`user_id`) ON DELETE NO ACTION ON UPDATE NO ACTION)
SELECT role_id FROM t_role WHERE technicalname = 'ROLE_ASSET_UPLOAD'), (SELECT group_id FROM t_group WHERE technicalname='member');
CREATE TABLE IF NOT EXISTS `fablab`.`v_group_user` (`email` INT, `group_id` INT, `user_id` INT, `technicalname` INT)
SELECT machine_type_id, technicalname, name, restricted FROM fablab_old.t_machine_type;
CREATE TABLE v_user_balance_grouped ( user_id tinyint NOT NULL, balance tinyint NOT NULL)
CREATE TABLE IF NOT EXISTS `fablab`.`t_role` ( `role_id` INT NOT NULL AUTO_INCREMENT, `name` VARCHAR(45) NOT NULL, `technicalname` VARCHAR(45) NOT NULL, PRIMARY KEY (`role_id`), UNIQUE INDEX `technicalname_UNIQUE` (`technicalname` ASC))
SELECT role_id FROM t_role WHERE technicalname = 'ROLE_ASSET_MANAGE'), (SELECT group_id FROM t_group WHERE technicalname='comite');
CREATE TABLE t_reservation ( reservation_id int(11) NOT NULL AUTO_INCREMENT, date_start datetime NOT NULL, date_end datetime NOT NULL, user_id int(11) NOT NULL, machine_id int(11) NOT NULL, PRIMARY KEY (reservation_id), KEY fk_t_reservation_t_users_idx (user_id), KEY fk_t_reservation_t_machines1_idx (machine_id), CONSTRAINT fk_t_reservation_t_machines1 FOREIGN KEY (machine_id) REFERENCES t_machine (machine_id) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT fk_t_reservation_t_users FOREIGN KEY (user_id) REFERENCES t_user (user_id) ON DELETE NO ACTION ON UPDATE NO ACTION)
CREATE TABLE IF NOT EXISTS `fablab`.`v_role_by_user` (`email` INT, `technicalname` INT)
SELECT 1, group_id FROM fablab_old.t_group WHERE technicalname='comite');
CREATE TABLE IF NOT EXISTS `fablab`.`t_reservation` ( `reservation_id` INT NOT NULL AUTO_INCREMENT, `date_start` DATETIME NOT NULL, `date_end` DATETIME NOT NULL, `user_id` INT NOT NULL, `machine_id` INT NOT NULL, PRIMARY KEY (`reservation_id`), INDEX `fk_t_reservation_t_users_idx` (`user_id` ASC), INDEX `fk_t_reservation_t_machines1_idx` (`machine_id` ASC), CONSTRAINT `fk_t_reservation_t_users` FOREIGN KEY (`user_id`) REFERENCES `fablab`.`t_user` (`user_id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_t_reservation_t_machines1` FOREIGN KEY (`machine_id`) REFERENCES `fablab`.`t_machine` (`machine_id`) ON DELETE NO ACTION ON UPDATE NO ACTION)
SELECT 12, group_id FROM fablab_old.t_group WHERE technicalname='member');
CREATE TABLE t_role ( role_id int(11) NOT NULL AUTO_INCREMENT, name varchar(45) NOT NULL, technicalname varchar(45) NOT NULL, PRIMARY KEY (role_id), UNIQUE KEY technicalname_UNIQUE (technicalname))
CREATE TABLE IF NOT EXISTS `fablab`.`r_price_machine` ( `machine_type_id` INT NOT NULL, `membership_type_id` INT NOT NULL, `price` FLOAT NOT NULL, PRIMARY KEY (`machine_type_id`, `membership_type_id`), INDEX `fk_r_price_t_machine_type1_idx` (`machine_type_id` ASC), INDEX `fk_r_price_t_membership_type1_idx` (`membership_type_id` ASC), CONSTRAINT `fk_r_price_t_machine_type1` FOREIGN KEY (`machine_type_id`) REFERENCES `fablab`.`t_machine_type` (`machine_type_id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_r_price_t_membership_type1` FOREIGN KEY (`membership_type_id`) REFERENCES `fablab`.`t_membership_type` (`membership_type_id`) ON DELETE NO ACTION ON UPDATE NO ACTION)
SELECT role_id FROM t_role WHERE technicalname = 'ROLE_PROJECT_CREATE'), (SELECT group_id FROM t_group WHERE technicalname='comite');
CREATE TABLE v_role_by_user ( email tinyint NOT NULL, technicalname tinyint NOT NULL)
SELECT user_id, total FROM v_user_balance_payment;
CREATE TABLE IF NOT EXISTS `fablab`.`t_audit` ( `audit_id` INT NOT NULL AUTO_INCREMENT, `who` INT NULL, `action` INT NOT NULL, `object` INT NOT NULL, `object_id` INT NULL, `dateandtime` DATETIME NOT NULL, `success` TINYINT(1) NOT NULL, `content` VARCHAR(1000) NOT NULL, `detail` TEXT NULL, PRIMARY KEY (`audit_id`), INDEX `fk_t_audits_t_users1_idx` (`who` ASC), CONSTRAINT `fk_t_audits_t_users1` FOREIGN KEY (`who`) REFERENCES `fablab`.`t_user` (`user_id`) ON DELETE NO ACTION ON UPDATE NO ACTION)
CREATE TABLE t_audit ( audit_id int(11) NOT NULL AUTO_INCREMENT, who int(11) DEFAULT NULL, action int(11) NOT NULL, object int(11) NOT NULL, object_id int(11) DEFAULT NULL, dateandtime datetime NOT NULL, success tinyint(1) NOT NULL, content varchar(1000) NOT NULL, detail text, PRIMARY KEY (audit_id), KEY fk_t_audits_t_users1_idx (who), CONSTRAINT fk_t_audits_t_users1 FOREIGN KEY (who) REFERENCES t_user (user_id) ON DELETE NO ACTION ON UPDATE NO ACTION)
CREATE TABLE IF NOT EXISTS `fablab`.`t_machine` ( `machine_id` INT NOT NULL AUTO_INCREMENT, `name` VARCHAR(45) NOT NULL, `machine_type_id` INT NOT NULL, PRIMARY KEY (`machine_id`), INDEX `fk_t_machines_t_machine_type1_idx` (`machine_type_id` ASC), CONSTRAINT `fk_t_machines_t_machine_type1` FOREIGN KEY (`machine_type_id`) REFERENCES `fablab`.`t_machine_type` (`machine_type_id`) ON DELETE NO ACTION ON UPDATE NO ACTION)
SELECT 6, group_id FROM fablab_old.t_group WHERE technicalname='comite');
CREATE TABLE t_payment ( payment_id int(11) NOT NULL AUTO_INCREMENT, total float NOT NULL, date_payement datetime NOT NULL, user_id int(11) NOT NULL, cashier_id int(11) NOT NULL, comment varchar(255) DEFAULT NULL, PRIMARY KEY (payment_id), KEY fk_t_payment_t_users2_idx (user_id), KEY fk_t_payment_t_users1_idx (cashier_id), CONSTRAINT fk_t_payment_t_users1 FOREIGN KEY (cashier_id) REFERENCES t_user (user_id) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT fk_t_payment_t_users2 FOREIGN KEY (user_id) REFERENCES t_user (user_id) ON DELETE NO ACTION ON UPDATE NO ACTION)
CREATE TABLE v_user_balance_payment ( firstname tinyint NOT NULL, lastname tinyint NOT NULL, user_id tinyint NOT NULL, total tinyint NOT NULL)
SELECT 13, group_id FROM fablab_old.t_group WHERE technicalname='comite');
