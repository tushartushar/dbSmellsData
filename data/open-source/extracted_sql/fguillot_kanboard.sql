CREATE TABLE project_daily_summaries ( id INTEGER PRIMARY KEY, day TEXT NOT NULL, project_id INTEGER NOT NULL, column_id INTEGER NOT NULL, total INTEGER NOT NULL DEFAULT 0, FOREIGN KEY(column_id) REFERENCES columns(id) ON DELETE CASCADE, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE )
CREATE TABLE user_has_notifications ( user_id INTEGER, project_id INTEGER, FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, UNIQUE(project_id, user_id) )
CREATE TABLE project_has_categories ( id INTEGER PRIMARY KEY, name TEXT COLLATE NOCASE NOT NULL, project_id INTEGER NOT NULL, UNIQUE (project_id, name), FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE )
CREATE TABLE task_has_metadata ( task_id INTEGER NOT NULL, name TEXT NOT NULL, value TEXT DEFAULT '', FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE, UNIQUE(task_id, name) )
INSERT INTO settings VALUES ('default_color', 'yellow')
CREATE TABLE project_has_categories ( id SERIAL PRIMARY KEY, name VARCHAR(255), project_id INTEGER, UNIQUE (project_id, name), FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE )
CREATE TABLE task_has_external_links ( id INTEGER PRIMARY KEY, link_type TEXT NOT NULL, dependency TEXT NOT NULL, title TEXT NOT NULL, url TEXT NOT NULL, date_creation INTEGER NOT NULL, date_modification INTEGER NOT NULL, task_id INTEGER NOT NULL, creator_id INTEGER DEFAULT 0, FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE )
CREATE INDEX users_admin_idx ON users(is_admin)');
CREATE TABLE tags ( id SERIAL PRIMARY KEY, name VARCHAR(255) NOT NULL, project_id INTEGER NOT NULL, UNIQUE(project_id, name) )
SELECT id FROM projects WHERE is_private=1');
UPDATE project_activities SET event_name=task WHERE event_name=file
CREATE TABLE `project_daily_column_stats` ( `id` int(11) NOT NULL AUTO_INCREMENT, `day` char(10) NOT NULL, `project_id` int(11) NOT NULL, `column_id` int(11) NOT NULL, `total` int(11) NOT NULL DEFAULT '0', `score` int(11) NOT NULL DEFAULT '0', PRIMARY KEY (`id`), UNIQUE KEY `project_daily_column_stats_idx` (`day`,`project_id`,`column_id`), KEY `column_id` (`column_id`), KEY `project_id` (`project_id`), CONSTRAINT `project_daily_column_stats_ibfk_1` FOREIGN KEY (`column_id`) REFERENCES `columns` (`id`) ON DELETE CASCADE, CONSTRAINT `project_daily_column_stats_ibfk_2` FOREIGN KEY (`project_id`) REFERENCES `projects` (`id`) ON DELETE CASCADE)
CREATE TABLE comments ( id INTEGER PRIMARY KEY, task_id INTEGER NOT NULL, user_id INTEGER DEFAULT 0, date_creation INTEGER NOT NULL, comment TEXT NOT NULL, reference VARCHAR(50), FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE )
CREATE TABLE `last_logins` ( `id` int(11) NOT NULL AUTO_INCREMENT, `auth_type` varchar(25) DEFAULT NULL, `user_id` int(11) DEFAULT NULL, `ip` varchar(45) DEFAULT NULL, `user_agent` varchar(255) DEFAULT NULL, `date_creation` bigint(20) DEFAULT NULL, PRIMARY KEY (`id`), KEY `user_id` (`user_id`), CONSTRAINT `last_logins_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE)
CREATE TABLE task_has_tags ( task_id INTEGER NOT NULL, tag_id INTEGER NOT NULL, FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE, FOREIGN KEY(tag_id) REFERENCES tags(id) ON DELETE CASCADE, UNIQUE(tag_id, task_id) )
UPDATE tasks SET date_moved = date_creation  WHERE date_moved IS NULL
CREATE TABLE `subtask_time_tracking` ( `id` int(11) NOT NULL AUTO_INCREMENT, `user_id` int(11) NOT NULL, `subtask_id` int(11) NOT NULL, `start` bigint(20) DEFAULT NULL, `end` bigint(20) DEFAULT NULL, `time_spent` float DEFAULT '0', PRIMARY KEY (`id`), KEY `user_id` (`user_id`), KEY `subtask_id` (`subtask_id`), CONSTRAINT `subtask_time_tracking_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE, CONSTRAINT `subtask_time_tracking_ibfk_2` FOREIGN KEY (`subtask_id`) REFERENCES `subtasks` (`id`) ON DELETE CASCADE)
CREATE TABLE custom_filters ( id SERIAL PRIMARY KEY, filter VARCHAR(100) NOT NULL, project_id INTEGER NOT NULL, user_id INTEGER NOT NULL, name VARCHAR(100) NOT NULL, is_shared BOOLEAN DEFAULT '0' )
UPDATE actions SET action_name=?  WHERE id=?)
CREATE TABLE users ( id INTEGER PRIMARY KEY, username TEXT NOT NULL, password TEXT, is_admin INTEGER DEFAULT 0 )
UPDATE subtasks SET position=?  WHERE id=?)
SELECT %s FROM %s WHERE %s='%d' AND %s='0' AND %s=%s LIMIT 1
CREATE TABLE project_has_groups ( `group_id` INT NOT NULL, `project_id` INT NOT NULL, `role` VARCHAR(25) NOT NULL, FOREIGN KEY(group_id) REFERENCES groups(id) ON DELETE CASCADE, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, UNIQUE(group_id, project_id) )
CREATE TABLE `password_reset` ( `token` varchar(80) NOT NULL, `user_id` int(11) NOT NULL, `date_expiration` int(11) NOT NULL, `date_creation` int(11) NOT NULL, `ip` varchar(45) NOT NULL, `user_agent` varchar(255) NOT NULL, `is_active` tinyint(1) NOT NULL, PRIMARY KEY (`token`), KEY `user_id` (`user_id`), CONSTRAINT `password_reset_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE)
SELECT id FROM users WHERE notifications_enabled=1');
CREATE TABLE comments ( id INTEGER PRIMARY KEY, task_id INTEGER, user_id INTEGER, date INTEGER, comment TEXT, FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE, FOREIGN KEY(user_id) REFERENCES tasks(id) ON DELETE CASCADE )
CREATE TABLE config ( language CHAR(5) DEFAULT 'en_US', webhooks_token VARCHAR(255) DEFAULT '', timezone VARCHAR(50) DEFAULT 'UTC' )
CREATE TABLE `project_daily_stats` ( `id` int(11) NOT NULL AUTO_INCREMENT, `day` char(10) NOT NULL, `project_id` int(11) NOT NULL, `avg_lead_time` int(11) NOT NULL DEFAULT '0', `avg_cycle_time` int(11) NOT NULL DEFAULT '0', PRIMARY KEY (`id`), UNIQUE KEY `project_daily_stats_idx` (`day`,`project_id`), KEY `project_id` (`project_id`), CONSTRAINT `project_daily_stats_ibfk_1` FOREIGN KEY (`project_id`) REFERENCES `projects` (`id`) ON DELETE CASCADE)
CREATE TABLE column_has_restrictions ( restriction_id SERIAL PRIMARY KEY, project_id INTEGER NOT NULL, role_id INTEGER NOT NULL, column_id INTEGER NOT NULL, rule VARCHAR(255) NOT NULL, UNIQUE(role_id, column_id, rule), FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, FOREIGN KEY(role_id) REFERENCES project_has_roles(role_id) ON DELETE CASCADE, FOREIGN KEY(column_id) REFERENCES columns(id) ON DELETE CASCADE )
CREATE TABLE project_activities ( id INTEGER PRIMARY KEY, date_creation INTEGER NOT NULL, event_name TEXT NOT NULL, creator_id INTEGE NOT NULL, project_id INTEGER NOT NULL, task_id INTEGER NOT NULL, data TEXT, FOREIGN KEY(creator_id) REFERENCES users(id) ON DELETE CASCADE, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE )
CREATE INDEX transitions_task_index ON transitions(task_id)
CREATE TABLE task_has_files ( id SERIAL PRIMARY KEY, name VARCHAR(255), path VARCHAR(255), is_image BOOLEAN DEFAULT '0', task_id INTEGER, FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE )
INSERT INTO schema_version VALUES ('97')
CREATE TABLE tasks ( id INT NOT NULL AUTO_INCREMENT, title VARCHAR(255), description TEXT, date_creation INT, date_completed INT, date_due INT, color_id VARCHAR(50), project_id INT, column_id INT, owner_id INT DEFAULT '0', position INT, score INT, is_active TINYINT DEFAULT 1, PRIMARY KEY (id), INDEX `idx_task_active` (is_active), FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, FOREIGN KEY(column_id) REFERENCES columns(id) ON DELETE CASCADE )
CREATE TABLE project_role_has_restrictions ( restriction_id INTEGER PRIMARY KEY, project_id INTEGER NOT NULL, role_id INTEGER NOT NULL, rule VARCHAR(255) NOT NULL, UNIQUE(role_id, rule), FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, FOREIGN KEY(role_id) REFERENCES project_has_roles(role_id) ON DELETE CASCADE )
CREATE TABLE task_has_links ( id INT NOT NULL AUTO_INCREMENT, link_id INT NOT NULL, task_id INT NOT NULL, opposite_task_id INT NOT NULL, FOREIGN KEY(link_id) REFERENCES links(id) ON DELETE CASCADE, FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE, FOREIGN KEY(opposite_task_id) REFERENCES tasks(id) ON DELETE CASCADE, PRIMARY KEY(id) )
INSERT INTO schema_version VALUES ('$$pg_version')
CREATE TABLE custom_filters ( id INTEGER PRIMARY KEY, filter TEXT NOT NULL, project_id INTEGER NOT NULL, user_id INTEGER NOT NULL, name TEXT NOT NULL, is_shared INTEGER DEFAULT 0 )
UPDATE project_has_users SET is_owner=1  WHERE project_id=?)
CREATE TABLE project_role_has_restrictions ( restriction_id SERIAL PRIMARY KEY, project_id INTEGER NOT NULL, role_id INTEGER NOT NULL, rule VARCHAR(255) NOT NULL, UNIQUE(role_id, rule), FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, FOREIGN KEY(role_id) REFERENCES project_has_roles(role_id) ON DELETE CASCADE )
CREATE TABLE group_has_users ( group_id INTEGER NOT NULL, user_id INTEGER NOT NULL, FOREIGN KEY(group_id) REFERENCES groups(id) ON DELETE CASCADE, FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE, UNIQUE(group_id, user_id) )
CREATE TABLE plugin_schema_versions ( plugin VARCHAR(80) NOT NULL, version INT NOT NULL DEFAULT 0, PRIMARY KEY(plugin) )
CREATE TABLE project_has_roles ( role_id INT NOT NULL AUTO_INCREMENT, role VARCHAR(255) NOT NULL, project_id INT NOT NULL, UNIQUE(project_id, role), FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, PRIMARY KEY(role_id) )
CREATE TABLE `user_has_notification_types` ( `id` int(11) NOT NULL AUTO_INCREMENT, `user_id` int(11) NOT NULL, `notification_type` varchar(50) DEFAULT NULL, PRIMARY KEY (`id`), UNIQUE KEY `user_has_notification_types_user_idx` (`user_id`,`notification_type`), CONSTRAINT `user_has_notification_types_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE)
CREATE TABLE user_has_unread_notifications ( id INT NOT NULL AUTO_INCREMENT, user_id INT NOT NULL, date_creation BIGINT NOT NULL, event_name VARCHAR(50) NOT NULL, event_data TEXT NOT NULL, PRIMARY KEY(id), FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE )
CREATE TABLE task_has_files ( id INTEGER PRIMARY KEY, name TEXT COLLATE NOCASE NOT NULL, path TEXT, is_image INTEGER DEFAULT 0, task_id INTEGER NOT NULL, FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE )
CREATE TABLE actions ( id INTEGER PRIMARY KEY, project_id INTEGER NOT NULL, event_name TEXT NOT NULL, action_name TEXT NOT NULL, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE )
CREATE TABLE task_has_external_links ( id SERIAL PRIMARY KEY, link_type VARCHAR(100) NOT NULL, dependency VARCHAR(100) NOT NULL, title VARCHAR(255) NOT NULL, url VARCHAR(255) NOT NULL, date_creation INT NOT NULL, date_modification INT NOT NULL, task_id INT NOT NULL, creator_id INT DEFAULT 0, FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE )
CREATE TABLE tags ( id INTEGER PRIMARY KEY, name TEXT NOT NULL, project_id INTEGER NOT NULL, UNIQUE(project_id, name) )
CREATE TABLE project_has_notification_types ( id SERIAL PRIMARY KEY, project_id INTEGER NOT NULL, notification_type VARCHAR(50) NOT NULL, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, UNIQUE(project_id, notification_type) )
INSERT INTO settings VALUES ('password_reset', '1')
CREATE TABLE project_has_users ( project_id INTEGER NOT NULL, user_id INTEGER NOT NULL, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE, UNIQUE(project_id, user_id) )
CREATE TABLE remember_me ( id INT NOT NULL AUTO_INCREMENT, user_id INT, ip VARCHAR(45), user_agent VARCHAR(255), token VARCHAR(255), sequence VARCHAR(255), expiration INT, date_creation INT, FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE, PRIMARY KEY (id) )
CREATE TABLE `schema_version` ( `version` int(11) DEFAULT '0')
CREATE TABLE `task_has_metadata` ( `task_id` int(11) NOT NULL, `name` varchar(50) NOT NULL, `value` varchar(255) DEFAULT '', `changed_by` int(11) NOT NULL DEFAULT '0', `changed_on` int(11) NOT NULL DEFAULT '0', UNIQUE KEY `task_id` (`task_id`,`name`), CONSTRAINT `task_has_metadata_ibfk_1` FOREIGN KEY (`task_id`) REFERENCES `tasks` (`id`) ON DELETE CASCADE)
CREATE TABLE `plugin_schema_versions` ( `plugin` varchar(80) NOT NULL, `version` int(11) NOT NULL DEFAULT '0', PRIMARY KEY (`plugin`))
CREATE TABLE `group_has_users` ( `group_id` int(11) NOT NULL, `user_id` int(11) NOT NULL, UNIQUE KEY `group_id` (`group_id`,`user_id`), KEY `user_id` (`user_id`), CONSTRAINT `group_has_users_ibfk_1` FOREIGN KEY (`group_id`) REFERENCES `groups` (`id`) ON DELETE CASCADE, CONSTRAINT `group_has_users_ibfk_2` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE)
CREATE TABLE subtask_has_events ( id INT NOT NULL AUTO_INCREMENT, date_creation INT NOT NULL, event_name TEXT NOT NULL, creator_id INT, project_id INT, subtask_id INT, task_id INT, data TEXT, FOREIGN KEY(creator_id) REFERENCES users(id) ON DELETE CASCADE, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, FOREIGN KEY(subtask_id) REFERENCES task_has_subtasks(id) ON DELETE CASCADE, FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE, PRIMARY KEY (id) )
CREATE TABLE project_daily_stats ( id INTEGER PRIMARY KEY, day TEXT NOT NULL, project_id INTEGER NOT NULL, avg_lead_time INTEGER NOT NULL DEFAULT 0, avg_cycle_time INTEGER NOT NULL DEFAULT 0, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE )
CREATE TABLE project_has_users ( id INT NOT NULL AUTO_INCREMENT, project_id INT, user_id INT, PRIMARY KEY (id), UNIQUE KEY `idx_project_user` (project_id, user_id), FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE )
CREATE TABLE `project_has_files` ( `id` int(11) NOT NULL AUTO_INCREMENT, `project_id` int(11) NOT NULL, `name` varchar(255) NOT NULL, `path` varchar(255) NOT NULL, `is_image` tinyint(1) DEFAULT '0', `size` int(11) NOT NULL DEFAULT '0', `user_id` int(11) NOT NULL DEFAULT '0', `date` int(11) NOT NULL DEFAULT '0', PRIMARY KEY (`id`), KEY `project_id` (`project_id`), CONSTRAINT `project_has_files_ibfk_1` FOREIGN KEY (`project_id`) REFERENCES `projects` (`id`) ON DELETE CASCADE)
CREATE TABLE task_has_events ( id INT NOT NULL AUTO_INCREMENT, date_creation INT NOT NULL, event_name TEXT NOT NULL, creator_id INT, project_id INT, task_id INT, data TEXT, FOREIGN KEY(creator_id) REFERENCES users(id) ON DELETE CASCADE, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE, PRIMARY KEY (id) )
CREATE TABLE `project_has_categories` ( `id` int(11) NOT NULL AUTO_INCREMENT, `name` varchar(255) NOT NULL, `project_id` int(11) NOT NULL, `description` text, PRIMARY KEY (`id`), UNIQUE KEY `idx_project_category` (`project_id`,`name`), KEY `categories_project_idx` (`project_id`), CONSTRAINT `project_has_categories_ibfk_1` FOREIGN KEY (`project_id`) REFERENCES `projects` (`id`) ON DELETE CASCADE)
select version from schema_version;' | mysql -N -uroot kanboard` ;
CREATE TABLE `groups` ( `id` int(11) NOT NULL AUTO_INCREMENT, `external_id` varchar(255) DEFAULT '', `name` varchar(100) NOT NULL, PRIMARY KEY (`id`), UNIQUE KEY `name` (`name`))
CREATE TABLE comments ( id SERIAL PRIMARY KEY, task_id INTEGER, user_id INTEGER, date INTEGER, comment TEXT, FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE, FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE )
CREATE TABLE `remember_me` ( `id` int(11) NOT NULL AUTO_INCREMENT, `user_id` int(11) DEFAULT NULL, `ip` varchar(45) DEFAULT NULL, `user_agent` varchar(255) DEFAULT NULL, `token` varchar(255) DEFAULT NULL, `sequence` varchar(255) DEFAULT NULL, `expiration` int(11) DEFAULT NULL, `date_creation` bigint(20) DEFAULT NULL, PRIMARY KEY (`id`), KEY `user_id` (`user_id`), CONSTRAINT `remember_me_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE)
CREATE TABLE user_has_notification_types ( id INT NOT NULL AUTO_INCREMENT, user_id INT NOT NULL, notification_type VARCHAR(50), PRIMARY KEY(id), FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE )
CREATE TABLE remember_me ( id INTEGER PRIMARY KEY, user_id INTEGER NOT NULL, ip TEXT, user_agent TEXT, token TEXT, sequence TEXT, expiration INTEGER, date_creation INTEGER, FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE )
CREATE TABLE user_has_notifications ( user_id INT, project_id INT, FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, UNIQUE(project_id, user_id) )
CREATE TABLE `task_has_tags` ( `task_id` int(11) NOT NULL, `tag_id` int(11) NOT NULL, UNIQUE KEY `tag_id` (`tag_id`,`task_id`), KEY `task_id` (`task_id`), CONSTRAINT `task_has_tags_ibfk_1` FOREIGN KEY (`task_id`) REFERENCES `tasks` (`id`) ON DELETE CASCADE, CONSTRAINT `task_has_tags_ibfk_2` FOREIGN KEY (`tag_id`) REFERENCES `tags` (`id`) ON DELETE CASCADE)
CREATE TABLE project_has_roles ( role_id INTEGER PRIMARY KEY, role TEXT NOT NULL, project_id INTEGER NOT NULL, UNIQUE(project_id, role), FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE )
UPDATE project_has_users SET is_owner=1  WHERE project_id=?
CREATE TABLE task_has_external_links ( id INT NOT NULL AUTO_INCREMENT, link_type VARCHAR(100) NOT NULL, dependency VARCHAR(100) NOT NULL, title VARCHAR(255) NOT NULL, url VARCHAR(255) NOT NULL, date_creation INT NOT NULL, date_modification INT NOT NULL, task_id INT NOT NULL, creator_id INT DEFAULT 0, FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE, PRIMARY KEY(id) )
CREATE TABLE custom_filters ( id INT NOT NULL AUTO_INCREMENT, filter VARCHAR(100) NOT NULL, project_id INT NOT NULL, user_id INT NOT NULL, name VARCHAR(100) NOT NULL, is_shared TINYINT(1) DEFAULT 0, PRIMARY KEY(id), FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE )
SELECT * FROM subtasks ORDER BY task_id, id ASC');
CREATE TABLE column_has_restrictions ( restriction_id INTEGER PRIMARY KEY, project_id INTEGER NOT NULL, role_id INTEGER NOT NULL, column_id INTEGER NOT NULL, rule VARCHAR(255) NOT NULL, UNIQUE(role_id, column_id, rule), FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, FOREIGN KEY(role_id) REFERENCES project_has_roles(role_id) ON DELETE CASCADE, FOREIGN KEY(column_id) REFERENCES columns(id) ON DELETE CASCADE )
CREATE TABLE column_has_move_restrictions ( restriction_id INTEGER PRIMARY KEY, project_id INTEGER NOT NULL, role_id INTEGER NOT NULL, src_column_id INTEGER NOT NULL, dst_column_id INTEGER NOT NULL, UNIQUE(role_id, src_column_id, dst_column_id), FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, FOREIGN KEY(role_id) REFERENCES project_has_roles(role_id) ON DELETE CASCADE, FOREIGN KEY(src_column_id) REFERENCES columns(id) ON DELETE CASCADE, FOREIGN KEY(dst_column_id) REFERENCES columns(id) ON DELETE CASCADE )
CREATE TABLE users ( id INT NOT NULL AUTO_INCREMENT, username VARCHAR(50), password VARCHAR(255), is_admin TINYINT DEFAULT 0, default_project_id INT DEFAULT 0, PRIMARY KEY (id) )
CREATE TABLE subtask_time_tracking ( id INTEGER PRIMARY KEY, user_id INTEGER NOT NULL, subtask_id INTEGER NOT NULL, start INTEGER DEFAULT 0, end INTEGER DEFAULT 0, FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE, FOREIGN KEY(subtask_id) REFERENCES task_has_subtasks(id) ON DELETE CASCADE )
CREATE INDEX comments_task_idx ON comments(task_id)');
SELECT id FROM users WHERE notifications_enabled='1'
CREATE TABLE comment_has_events ( id SERIAL PRIMARY KEY, date_creation INTEGER NOT NULL, event_name VARCHAR(50) NOT NULL, creator_id INTEGER, project_id INTEGER, comment_id INTEGER, task_id INTEGER, data TEXT, FOREIGN KEY(creator_id) REFERENCES users(id) ON DELETE CASCADE, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, FOREIGN KEY(comment_id) REFERENCES comments(id) ON DELETE CASCADE, FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE )
SELECT * FROM actions');
CREATE TABLE users ( id SERIAL PRIMARY KEY, username VARCHAR(50), password VARCHAR(255), is_admin BOOLEAN DEFAULT '0', default_project_id INTEGER DEFAULT 0, is_ldap_user BOOLEAN DEFAULT '0', name VARCHAR(255), email VARCHAR(255), google_id VARCHAR(255), github_id VARCHAR(30) )
CREATE TABLE remember_me ( id SERIAL PRIMARY KEY, user_id INTEGER, ip VARCHAR(45), user_agent VARCHAR(255), token VARCHAR(255), sequence VARCHAR(255), expiration INTEGER, date_creation INTEGER, FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE )
CREATE TABLE `actions` ( `id` int(11) NOT NULL AUTO_INCREMENT, `project_id` int(11) NOT NULL, `event_name` varchar(50) NOT NULL, `action_name` varchar(255) DEFAULT NULL, PRIMARY KEY (`id`), KEY `project_id` (`project_id`), CONSTRAINT `actions_ibfk_1` FOREIGN KEY (`project_id`) REFERENCES `projects` (`id`) ON DELETE CASCADE)
CREATE TABLE `task_has_links` ( `id` int(11) NOT NULL AUTO_INCREMENT, `link_id` int(11) NOT NULL, `task_id` int(11) NOT NULL, `opposite_task_id` int(11) NOT NULL, PRIMARY KEY (`id`), UNIQUE KEY `task_has_links_unique` (`link_id`,`task_id`,`opposite_task_id`), KEY `opposite_task_id` (`opposite_task_id`), KEY `task_has_links_task_index` (`task_id`), CONSTRAINT `task_has_links_ibfk_1` FOREIGN KEY (`link_id`) REFERENCES `links` (`id`) ON DELETE CASCADE, CONSTRAINT `task_has_links_ibfk_2` FOREIGN KEY (`task_id`) REFERENCES `tasks` (`id`) ON DELETE CASCADE, CONSTRAINT `task_has_links_ibfk_3` FOREIGN KEY (`opposite_task_id`) REFERENCES `tasks` (`id`) ON DELETE CASCADE)
INSERT INTO settings VALUES ('cfd_include_closed_tasks', '1')
CREATE TABLE project_daily_summaries ( id INT NOT NULL AUTO_INCREMENT, day CHAR(10) NOT NULL, project_id INT NOT NULL, column_id INT NOT NULL, total INT NOT NULL DEFAULT 0, PRIMARY KEY(id), FOREIGN KEY(column_id) REFERENCES columns(id) ON DELETE CASCADE, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE )
CREATE INDEX tasks_project_idx ON tasks(project_id)');
CREATE TABLE `project_has_groups` ( `group_id` int(11) NOT NULL, `project_id` int(11) NOT NULL, `role` varchar(255) NOT NULL, UNIQUE KEY `group_id` (`group_id`,`project_id`), KEY `project_id` (`project_id`), CONSTRAINT `project_has_groups_ibfk_1` FOREIGN KEY (`group_id`) REFERENCES `groups` (`id`) ON DELETE CASCADE, CONSTRAINT `project_has_groups_ibfk_2` FOREIGN KEY (`project_id`) REFERENCES `projects` (`id`) ON DELETE CASCADE)
CREATE TABLE `settings` ( `option` varchar(100) NOT NULL, `value` text, `changed_by` int(11) NOT NULL DEFAULT '0', `changed_on` int(11) NOT NULL DEFAULT '0', PRIMARY KEY (`option`))
CREATE TABLE action_has_params ( id SERIAL PRIMARY KEY, action_id INTEGER, name VARCHAR(50), value VARCHAR(50), FOREIGN KEY(action_id) REFERENCES actions(id) ON DELETE CASCADE )
CREATE TABLE project_integrations ( `id` INT NOT NULL AUTO_INCREMENT, `project_id` INT NOT NULL UNIQUE, `hipchat` TINYINT(1) DEFAULT 0, `hipchat_api_url` VARCHAR(255) DEFAULT 'https://api.hipchat.com', `hipchat_room_id` VARCHAR(255), `hipchat_room_token` VARCHAR(255), `slack` TINYINT(1) DEFAULT 0, `slack_webhook_url` VARCHAR(255), FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, PRIMARY KEY(id) )
CREATE TABLE subtask_has_events ( id INTEGER PRIMARY KEY, date_creation INTEGER NOT NULL, event_name TEXT NOT NULL, creator_id INTEGER, project_id INTEGER, subtask_id INTEGER, task_id INTEGER, data TEXT, FOREIGN KEY(creator_id) REFERENCES users(id) ON DELETE CASCADE, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, FOREIGN KEY(subtask_id) REFERENCES task_has_subtasks(id) ON DELETE CASCADE, FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE )
CREATE TABLE user_has_metadata ( user_id INT NOT NULL, name VARCHAR(50) NOT NULL, value VARCHAR(255) DEFAULT '', FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE, UNIQUE(user_id, name) )
CREATE TABLE project_activities ( id INT NOT NULL AUTO_INCREMENT, date_creation INT NOT NULL, event_name VARCHAR(50) NOT NULL, creator_id INT, project_id INT, task_id INT, data TEXT, PRIMARY KEY(id), FOREIGN KEY(creator_id) REFERENCES users(id) ON DELETE CASCADE, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE )
CREATE TABLE `project_has_users` ( `project_id` int(11) NOT NULL, `user_id` int(11) NOT NULL, `role` varchar(255) NOT NULL, UNIQUE KEY `idx_project_user` (`project_id`,`user_id`), KEY `user_id` (`user_id`), CONSTRAINT `project_has_users_ibfk_1` FOREIGN KEY (`project_id`) REFERENCES `projects` (`id`) ON DELETE CASCADE, CONSTRAINT `project_has_users_ibfk_2` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE)
CREATE TABLE comments ( id INT NOT NULL AUTO_INCREMENT, task_id INT, user_id INT, `date` INT, comment TEXT, PRIMARY KEY (id), FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE, FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE )
SELECT * FROM config');
CREATE TABLE projects ( id INTEGER PRIMARY KEY, name TEXT NOCASE NOT NULL, is_active INTEGER DEFAULT 1 )
CREATE INDEX swimlanes_project_idx ON swimlanes(project_id)');
CREATE TABLE plugin_schema_versions ( plugin TEXT NOT NULL PRIMARY KEY, version INTEGER NOT NULL DEFAULT 0 )
CREATE TABLE user_has_notifications ( user_id INTEGER NOT NULL, project_id INTEGER NOT NULL, FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, UNIQUE(project_id, user_id) )
CREATE TABLE task_has_subtasks ( id INT NOT NULL AUTO_INCREMENT, title VARCHAR(255), status INT DEFAULT 0, time_estimated INT DEFAULT 0, time_spent INT DEFAULT 0, task_id INT NOT NULL, user_id INT, PRIMARY KEY (id), FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE )
CREATE TABLE project_daily_stats ( id INT NOT NULL AUTO_INCREMENT, day CHAR(10) NOT NULL, project_id INT NOT NULL, avg_lead_time INT NOT NULL DEFAULT 0, avg_cycle_time INT NOT NULL DEFAULT 0, PRIMARY KEY(id), FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE )
CREATE TABLE swimlanes ( id INT NOT NULL AUTO_INCREMENT, name VARCHAR(200) NOT NULL, position INT DEFAULT 1, is_active INT DEFAULT 1, project_id INT, PRIMARY KEY(id), FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, UNIQUE (name, project_id) )
CREATE TABLE user_has_unread_notifications ( id SERIAL PRIMARY KEY, user_id INTEGER NOT NULL, date_creation BIGINT NOT NULL, event_name VARCHAR(50) NOT NULL, event_data TEXT NOT NULL, FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE )
CREATE TABLE project_has_notification_types ( id INTEGER PRIMARY KEY, project_id INTEGER NOT NULL, notification_type TEXT NOT NULL, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, UNIQUE(project_id, notification_type) )
CREATE INDEX comments_reference_idx ON comments(reference)');
CREATE TABLE config ( language TEXT DEFAULT 'en_US', webhooks_token TEXT DEFAULT '' )
CREATE TABLE project_has_users ( id SERIAL PRIMARY KEY, project_id INTEGER, user_id INTEGER, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE, UNIQUE(project_id, user_id) )
CREATE TABLE task_has_events ( id SERIAL PRIMARY KEY, date_creation INTEGER NOT NULL, event_name VARCHAR(50) NOT NULL, creator_id INTEGER, project_id INTEGER, task_id INTEGER, data TEXT, FOREIGN KEY(creator_id) REFERENCES users(id) ON DELETE CASCADE, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE )
CREATE TABLE `projects` ( `id` int(11) NOT NULL AUTO_INCREMENT, `name` varchar(255) NOT NULL, `is_active` tinyint(4) DEFAULT '1', `token` varchar(255) DEFAULT NULL, `last_modified` bigint(20) DEFAULT NULL, `is_public` tinyint(1) DEFAULT '0', `is_private` tinyint(1) DEFAULT '0', `is_everybody_allowed` tinyint(1) DEFAULT '0', `default_swimlane` varchar(200) DEFAULT 'Default swimlane', `show_default_swimlane` int(11) DEFAULT '1', `description` text, `identifier` varchar(50) DEFAULT '', `start_date` varchar(10) DEFAULT '', `end_date` varchar(10) DEFAULT '', `owner_id` int(11) DEFAULT '0', `priority_default` int(11) DEFAULT '0', `priority_start` int(11) DEFAULT '0', `priority_end` int(11) DEFAULT '3', PRIMARY KEY (`id`))
CREATE TABLE `columns` ( `id` int(11) NOT NULL AUTO_INCREMENT, `title` varchar(255) NOT NULL, `position` int(11) NOT NULL, `project_id` int(11) NOT NULL, `task_limit` int(11) DEFAULT '0', `description` text, `hide_in_dashboard` int(11) NOT NULL DEFAULT '0', PRIMARY KEY (`id`), UNIQUE KEY `idx_title_project` (`title`,`project_id`), KEY `columns_project_idx` (`project_id`), CONSTRAINT `columns_ibfk_1` FOREIGN KEY (`project_id`) REFERENCES `projects` (`id`) ON DELETE CASCADE)
CREATE TABLE `comments` ( `id` int(11) NOT NULL AUTO_INCREMENT, `task_id` int(11) NOT NULL, `user_id` int(11) DEFAULT '0', `date_creation` bigint(20) DEFAULT NULL, `comment` text, `reference` varchar(50) DEFAULT '', PRIMARY KEY (`id`), KEY `user_id` (`user_id`), KEY `comments_reference_idx` (`reference`), KEY `comments_task_idx` (`task_id`), CONSTRAINT `comments_ibfk_1` FOREIGN KEY (`task_id`) REFERENCES `tasks` (`id`) ON DELETE CASCADE)
CREATE TABLE task_has_links ( id INTEGER PRIMARY KEY, link_id INTEGER NOT NULL, task_id INTEGER NOT NULL, opposite_task_id INTEGER NOT NULL, FOREIGN KEY(link_id) REFERENCES links(id) ON DELETE CASCADE, FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE, FOREIGN KEY(opposite_task_id) REFERENCES tasks(id) ON DELETE CASCADE )
CREATE TABLE projects ( id INT NOT NULL AUTO_INCREMENT, name VARCHAR(50) UNIQUE, is_active TINYINT DEFAULT 1, token VARCHAR(255), PRIMARY KEY (id) )
CREATE TABLE column_has_restrictions ( restriction_id INT NOT NULL AUTO_INCREMENT, project_id INT NOT NULL, role_id INT NOT NULL, column_id INT NOT NULL, rule VARCHAR(255) NOT NULL, UNIQUE(role_id, column_id, rule), FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, FOREIGN KEY(role_id) REFERENCES project_has_roles(role_id) ON DELETE CASCADE, FOREIGN KEY(column_id) REFERENCES columns(id) ON DELETE CASCADE, PRIMARY KEY(restriction_id) )
CREATE TABLE task_has_tags ( task_id INT NOT NULL, tag_id INT NOT NULL, FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE, FOREIGN KEY(tag_id) REFERENCES tags(id) ON DELETE CASCADE, UNIQUE(tag_id, task_id) )
CREATE TABLE plugin_schema_versions ( plugin VARCHAR(80) NOT NULL PRIMARY KEY, version INTEGER NOT NULL DEFAULT 0 )
CREATE TABLE user_has_notification_types ( id INTEGER PRIMARY KEY, user_id INTEGER NOT NULL, notification_type TEXT, FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE )
CREATE TABLE tags ( id INT NOT NULL AUTO_INCREMENT, name VARCHAR(255) NOT NULL, project_id INT NOT NULL, UNIQUE(project_id, name), PRIMARY KEY(id) )
CREATE TABLE task_has_metadata ( task_id INT NOT NULL, name VARCHAR(50) NOT NULL, value VARCHAR(255) DEFAULT '', FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE, UNIQUE(task_id, name) )
CREATE TABLE currencies (`currency` CHAR(3) NOT NULL UNIQUE, `rate` FLOAT DEFAULT 0)
CREATE TABLE project_has_files ( `id` INT NOT NULL AUTO_INCREMENT, `project_id` INT NOT NULL, `name` VARCHAR(255) NOT NULL, `path` VARCHAR(255) NOT NULL, `is_image` TINYINT(1) DEFAULT 0, `size` INT DEFAULT 0 NOT NULL, `user_id` INT DEFAULT 0 NOT NULL, `date` INT DEFAULT 0 NOT NULL, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, PRIMARY KEY(id) )
CREATE TABLE `custom_filters` ( `id` int(11) NOT NULL AUTO_INCREMENT, `filter` varchar(100) NOT NULL, `project_id` int(11) NOT NULL, `user_id` int(11) NOT NULL, `name` varchar(100) NOT NULL, `is_shared` tinyint(1) DEFAULT '0', `append` tinyint(1) DEFAULT '0', PRIMARY KEY (`id`), KEY `project_id` (`project_id`), KEY `user_id` (`user_id`), CONSTRAINT `custom_filters_ibfk_1` FOREIGN KEY (`project_id`) REFERENCES `projects` (`id`) ON DELETE CASCADE, CONSTRAINT `custom_filters_ibfk_2` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE)
CREATE TABLE settings ( option TEXT PRIMARY KEY, value TEXT DEFAULT '' )
INSERT INTO settings VALUES ('subtask_time_tracking', '1')
CREATE TABLE user_has_notification_types ( id SERIAL PRIMARY KEY, user_id INTEGER NOT NULL, notification_type VARCHAR(50), FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE )
CREATE TABLE actions ( id SERIAL PRIMARY KEY, project_id INTEGER, event_name VARCHAR(50), action_name VARCHAR(50), FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE )
CREATE TABLE tasks ( id SERIAL PRIMARY KEY, title VARCHAR(255), description TEXT, date_creation INTEGER, color_id VARCHAR(255), project_id INTEGER, column_id INTEGER, owner_id INTEGER DEFAULT 0, position INTEGER, is_active BOOLEAN DEFAULT '1', date_completed INTEGER, score INTEGER, date_due INTEGER, category_id INTEGER DEFAULT 0, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, FOREIGN KEY(column_id) REFERENCES columns(id) ON DELETE CASCADE )
CREATE TABLE task_has_metadata ( task_id INTEGER NOT NULL, name VARCHAR(50) NOT NULL, value VARCHAR(255) DEFAULT '', FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE, UNIQUE(task_id, name) )
CREATE TABLE project_integrations ( id INTEGER PRIMARY KEY, project_id INTEGER NOT NULL UNIQUE, hipchat INTEGER DEFAULT 0, hipchat_api_url TEXT DEFAULT 'https://api.hipchat.com', hipchat_room_id TEXT, hipchat_room_token TEXT, slack INTEGER DEFAULT 0, slack_webhook_url TEXT, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE )
CREATE TABLE last_logins ( id INTEGER PRIMARY KEY, auth_type TEXT, user_id INTEGER NOT NULL, ip TEXT, user_agent TEXT, date_creation INTEGER, FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE )
INSERT INTO settings VALUES ('integration_slack_webhook_channel', '')
CREATE TABLE `column_has_move_restrictions` ( `restriction_id` int(11) NOT NULL AUTO_INCREMENT, `project_id` int(11) NOT NULL, `role_id` int(11) NOT NULL, `src_column_id` int(11) NOT NULL, `dst_column_id` int(11) NOT NULL, PRIMARY KEY (`restriction_id`), UNIQUE KEY `role_id` (`role_id`,`src_column_id`,`dst_column_id`), KEY `project_id` (`project_id`), KEY `src_column_id` (`src_column_id`), KEY `dst_column_id` (`dst_column_id`), CONSTRAINT `column_has_move_restrictions_ibfk_1` FOREIGN KEY (`project_id`) REFERENCES `projects` (`id`) ON DELETE CASCADE, CONSTRAINT `column_has_move_restrictions_ibfk_2` FOREIGN KEY (`role_id`) REFERENCES `project_has_roles` (`role_id`) ON DELETE CASCADE, CONSTRAINT `column_has_move_restrictions_ibfk_3` FOREIGN KEY (`src_column_id`) REFERENCES `columns` (`id`) ON DELETE CASCADE, CONSTRAINT `column_has_move_restrictions_ibfk_4` FOREIGN KEY (`dst_column_id`) REFERENCES `columns` (`id`) ON DELETE CASCADE)
INSERT INTO settings VALUES (?, ?)
CREATE TABLE `task_has_external_links` ( `id` int(11) NOT NULL AUTO_INCREMENT, `link_type` varchar(100) NOT NULL, `dependency` varchar(100) NOT NULL, `title` varchar(255) NOT NULL, `url` varchar(255) NOT NULL, `date_creation` int(11) NOT NULL, `date_modification` int(11) NOT NULL, `task_id` int(11) NOT NULL, `creator_id` int(11) DEFAULT '0', PRIMARY KEY (`id`), KEY `task_id` (`task_id`), CONSTRAINT `task_has_external_links_ibfk_1` FOREIGN KEY (`task_id`) REFERENCES `tasks` (`id`) ON DELETE CASCADE)
CREATE INDEX columns_project_idx ON columns(project_id)');
CREATE TABLE project_has_metadata ( project_id INT NOT NULL, name VARCHAR(50) NOT NULL, value VARCHAR(255) DEFAULT '', FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, UNIQUE(project_id, name) )
CREATE TABLE task_has_events ( id INTEGER PRIMARY KEY, date_creation INTEGER NOT NULL, event_name TEXT NOT NULL, creator_id INTEGER, project_id INTEGER, task_id INTEGER, data TEXT, FOREIGN KEY(creator_id) REFERENCES users(id) ON DELETE CASCADE, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE )
CREATE INDEX task_has_links_task_index ON task_has_links(task_id)
CREATE TABLE links ( id INT NOT NULL AUTO_INCREMENT, label VARCHAR(255) NOT NULL, opposite_id INT DEFAULT 0, PRIMARY KEY(id), UNIQUE(label) )
CREATE TABLE action_has_params ( id INT NOT NULL AUTO_INCREMENT, action_id INT, name VARCHAR(50), value VARCHAR(50), PRIMARY KEY (id), FOREIGN KEY(action_id) REFERENCES actions(id) ON DELETE CASCADE )
CREATE TABLE columns ( id SERIAL PRIMARY KEY, title VARCHAR(255), position INTEGER, project_id INTEGER, task_limit INTEGER DEFAULT 0, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, UNIQUE (title, project_id) )
CREATE TABLE `user_has_notifications` ( `user_id` int(11) NOT NULL, `project_id` int(11) NOT NULL, UNIQUE KEY `user_has_notifications_unique_idx` (`user_id`,`project_id`), KEY `user_has_notifications_ibfk_2` (`project_id`), CONSTRAINT `user_has_notifications_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE, CONSTRAINT `user_has_notifications_ibfk_2` FOREIGN KEY (`project_id`) REFERENCES `projects` (`id`) ON DELETE CASCADE)
CREATE TABLE password_reset ( token VARCHAR(80) PRIMARY KEY, user_id INTEGER NOT NULL, date_expiration INTEGER NOT NULL, date_creation INTEGER NOT NULL, ip VARCHAR(45) NOT NULL, user_agent VARCHAR(255) NOT NULL, is_active BOOLEAN NOT NULL, FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE )
CREATE TABLE last_logins ( id INT NOT NULL AUTO_INCREMENT, auth_type VARCHAR(25), user_id INT, ip VARCHAR(45), user_agent VARCHAR(255), date_creation INT, FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE, PRIMARY KEY (id), INDEX (user_id) )
CREATE TABLE projects ( id SERIAL PRIMARY KEY, name VARCHAR(255) UNIQUE, is_active BOOLEAN DEFAULT '1', token VARCHAR(255), last_modified INTEGER DEFAULT 0 )
CREATE TABLE `currencies` ( `currency` char(3) NOT NULL, `rate` float DEFAULT '0', UNIQUE KEY `currency` (`currency`))
CREATE TABLE `user_has_unread_notifications` ( `id` int(11) NOT NULL AUTO_INCREMENT, `user_id` int(11) NOT NULL, `date_creation` bigint(20) NOT NULL, `event_name` varchar(50) NOT NULL, `event_data` text NOT NULL, PRIMARY KEY (`id`), KEY `user_id` (`user_id`), CONSTRAINT `user_has_unread_notifications_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE)
CREATE TABLE column_has_move_restrictions ( restriction_id SERIAL PRIMARY KEY, project_id INTEGER NOT NULL, role_id INTEGER NOT NULL, src_column_id INTEGER NOT NULL, dst_column_id INTEGER NOT NULL, UNIQUE(role_id, src_column_id, dst_column_id), FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, FOREIGN KEY(role_id) REFERENCES project_has_roles(role_id) ON DELETE CASCADE, FOREIGN KEY(src_column_id) REFERENCES columns(id) ON DELETE CASCADE, FOREIGN KEY(dst_column_id) REFERENCES columns(id) ON DELETE CASCADE )
CREATE TABLE actions ( id INT NOT NULL AUTO_INCREMENT, project_id INT, event_name VARCHAR(50), action_name VARCHAR(50), PRIMARY KEY (id), FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE )
CREATE TABLE project_has_notification_types ( id INT NOT NULL AUTO_INCREMENT, project_id INT NOT NULL, notification_type VARCHAR(50) NOT NULL, PRIMARY KEY(id), FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, UNIQUE(project_id, notification_type) )
INSERT INTO schema_version VALUES ('118')
CREATE TABLE task_has_subtasks ( id INTEGER PRIMARY KEY, title TEXT COLLATE NOCASE NOT NULL, status INTEGER DEFAULT 0, time_estimated NUMERIC DEFAULT 0, time_spent NUMERIC DEFAULT 0, task_id INTEGER NOT NULL, user_id INTEGER, FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE )
CREATE TABLE action_has_params ( id INTEGER PRIMARY KEY, action_id INTEGER NOT NULL, name TEXT NOT NULL, value TEXT NOT NULL, FOREIGN KEY(action_id) REFERENCES actions(id) ON DELETE CASCADE )
CREATE TABLE project_has_files ( id INTEGER PRIMARY KEY, project_id INTEGER NOT NULL, name TEXT COLLATE NOCASE NOT NULL, path TEXT NOT NULL, is_image INTEGER DEFAULT 0, size INTEGER DEFAULT 0 NOT NULL, user_id INTEGER DEFAULT 0 NOT NULL, date INTEGER DEFAULT 0 NOT NULL, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE )
CREATE TABLE `project_has_roles` ( `role_id` int(11) NOT NULL AUTO_INCREMENT, `role` varchar(255) NOT NULL, `project_id` int(11) NOT NULL, PRIMARY KEY (`role_id`), UNIQUE KEY `project_id` (`project_id`,`role`), CONSTRAINT `project_has_roles_ibfk_1` FOREIGN KEY (`project_id`) REFERENCES `projects` (`id`) ON DELETE CASCADE)
SELECT * FROM "users"');
CREATE TABLE comments ( id INTEGER PRIMARY KEY, task_id INTEGER, user_id INTEGER, date INTEGER, comment TEXT, FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE, FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE )
CREATE TABLE project_daily_summaries ( id SERIAL PRIMARY KEY, day CHAR(10) NOT NULL, project_id INTEGER NOT NULL, column_id INTEGER NOT NULL, total INTEGER NOT NULL DEFAULT 0, FOREIGN KEY(column_id) REFERENCES columns(id) ON DELETE CASCADE, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE )
CREATE TABLE `action_has_params` ( `id` int(11) NOT NULL AUTO_INCREMENT, `action_id` int(11) NOT NULL, `name` varchar(50) NOT NULL, `value` varchar(50) NOT NULL, PRIMARY KEY (`id`), KEY `action_id` (`action_id`), CONSTRAINT `action_has_params_ibfk_1` FOREIGN KEY (`action_id`) REFERENCES `actions` (`id`) ON DELETE CASCADE)
CREATE TABLE project_has_files ( id SERIAL PRIMARY KEY, project_id INTEGER NOT NULL, name VARCHAR(255) NOT NULL, path VARCHAR(255) NOT NULL, is_image BOOLEAN DEFAULT '0', size INTEGER DEFAULT 0 NOT NULL, user_id INTEGER DEFAULT 0 NOT NULL, date INTEGER DEFAULT 0 NOT NULL, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE )
CREATE TABLE group_has_users ( group_id INT NOT NULL, user_id INT NOT NULL, FOREIGN KEY(group_id) REFERENCES groups(id) ON DELETE CASCADE, FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE, UNIQUE(group_id, user_id) )
CREATE TABLE tasks ( id INTEGER PRIMARY KEY, title TEXT NOCASE NOT NULL, description TEXT, date_creation INTEGER, color_id TEXT, project_id INTEGER, column_id INTEGER, owner_id INTEGER DEFAULT '0', position INTEGER, is_active INTEGER DEFAULT 1, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, FOREIGN KEY(column_id) REFERENCES columns(id) ON DELETE CASCADE )
CREATE TABLE project_activities ( id SERIAL PRIMARY KEY, date_creation INTEGER NOT NULL, event_name VARCHAR(50) NOT NULL, creator_id INTEGER, project_id INTEGER, task_id INTEGER, data TEXT, FOREIGN KEY(creator_id) REFERENCES users(id) ON DELETE CASCADE, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE )
CREATE TABLE project_has_metadata ( project_id INTEGER NOT NULL, name TEXT NOT NULL, value TEXT DEFAULT '', FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, UNIQUE(project_id, name) )
CREATE TABLE comment_has_events ( id INTEGER PRIMARY KEY, date_creation INTEGER NOT NULL, event_name TEXT NOT NULL, creator_id INTEGER, project_id INTEGER, comment_id INTEGER, task_id INTEGER, data TEXT, FOREIGN KEY(creator_id) REFERENCES users(id) ON DELETE CASCADE, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, FOREIGN KEY(comment_id) REFERENCES comments(id) ON DELETE CASCADE, FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE )
CREATE TABLE project_integrations ( id SERIAL PRIMARY KEY, project_id INTEGER NOT NULL UNIQUE, hipchat BOOLEAN DEFAULT '0', hipchat_api_url VARCHAR(255) DEFAULT 'https://api.hipchat.com', hipchat_room_id VARCHAR(255), hipchat_room_token VARCHAR(255), slack BOOLEAN DEFAULT '0', slack_webhook_url VARCHAR(255), FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE )
CREATE TABLE `column_has_restrictions` ( `restriction_id` int(11) NOT NULL AUTO_INCREMENT, `project_id` int(11) NOT NULL, `role_id` int(11) NOT NULL, `column_id` int(11) NOT NULL, `rule` varchar(255) NOT NULL, PRIMARY KEY (`restriction_id`), UNIQUE KEY `role_id` (`role_id`,`column_id`,`rule`), KEY `project_id` (`project_id`), KEY `column_id` (`column_id`), CONSTRAINT `column_has_restrictions_ibfk_1` FOREIGN KEY (`project_id`) REFERENCES `projects` (`id`) ON DELETE CASCADE, CONSTRAINT `column_has_restrictions_ibfk_2` FOREIGN KEY (`role_id`) REFERENCES `project_has_roles` (`role_id`) ON DELETE CASCADE, CONSTRAINT `column_has_restrictions_ibfk_3` FOREIGN KEY (`column_id`) REFERENCES `columns` (`id`) ON DELETE CASCADE)
CREATE TABLE groups ( id SERIAL PRIMARY KEY, external_id VARCHAR(255) DEFAULT '', name VARCHAR(100) NOT NULL UNIQUE )
CREATE TABLE config ( language CHAR(5) DEFAULT 'en_US', webhooks_token VARCHAR(255) DEFAULT '', timezone VARCHAR(50) DEFAULT 'UTC', api_token VARCHAR(255) DEFAULT '' )
CREATE TABLE project_role_has_restrictions ( restriction_id INT NOT NULL AUTO_INCREMENT, project_id INT NOT NULL, role_id INT NOT NULL, rule VARCHAR(255) NOT NULL, UNIQUE(role_id, rule), FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, FOREIGN KEY(role_id) REFERENCES project_has_roles(role_id) ON DELETE CASCADE, PRIMARY KEY(restriction_id) )
CREATE TABLE last_logins ( id SERIAL PRIMARY KEY, auth_type VARCHAR(25), user_id INTEGER, ip VARCHAR(45), user_agent VARCHAR(255), date_creation INTEGER, FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE )
CREATE TABLE `tags` ( `id` int(11) NOT NULL AUTO_INCREMENT, `name` varchar(255) NOT NULL, `project_id` int(11) NOT NULL, PRIMARY KEY (`id`), UNIQUE KEY `project_id` (`project_id`,`name`))
CREATE TABLE project_daily_stats ( id SERIAL PRIMARY KEY, day CHAR(10) NOT NULL, project_id INTEGER NOT NULL, avg_lead_time INTEGER NOT NULL DEFAULT 0, avg_cycle_time INTEGER NOT NULL DEFAULT 0, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE )
CREATE TABLE `user_has_metadata` ( `user_id` int(11) NOT NULL, `name` varchar(50) NOT NULL, `value` varchar(255) DEFAULT '', `changed_by` int(11) NOT NULL DEFAULT '0', `changed_on` int(11) NOT NULL DEFAULT '0', UNIQUE KEY `user_id` (`user_id`,`name`), CONSTRAINT `user_has_metadata_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE)
CREATE TABLE password_reset ( token TEXT PRIMARY KEY, user_id INTEGER NOT NULL, date_expiration INTEGER NOT NULL, date_creation INTEGER NOT NULL, ip TEXT NOT NULL, user_agent TEXT NOT NULL, is_active INTEGER NOT NULL, FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE )
CREATE TABLE `project_role_has_restrictions` ( `restriction_id` int(11) NOT NULL AUTO_INCREMENT, `project_id` int(11) NOT NULL, `role_id` int(11) NOT NULL, `rule` varchar(255) NOT NULL, PRIMARY KEY (`restriction_id`), UNIQUE KEY `role_id` (`role_id`,`rule`), KEY `project_id` (`project_id`), CONSTRAINT `project_role_has_restrictions_ibfk_1` FOREIGN KEY (`project_id`) REFERENCES `projects` (`id`) ON DELETE CASCADE, CONSTRAINT `project_role_has_restrictions_ibfk_2` FOREIGN KEY (`role_id`) REFERENCES `project_has_roles` (`role_id`) ON DELETE CASCADE)
CREATE TABLE password_reset ( token VARCHAR(80) PRIMARY KEY, user_id INT NOT NULL, date_expiration INT NOT NULL, date_creation INT NOT NULL, ip VARCHAR(45) NOT NULL, user_agent VARCHAR(255) NOT NULL, is_active TINYINT(1) NOT NULL, FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE )
CREATE TABLE user_has_unread_notifications ( id INTEGER PRIMARY KEY, user_id INTEGER NOT NULL, date_creation INTEGER NOT NULL, event_name TEXT NOT NULL, event_data TEXT NOT NULL, FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE )
CREATE INDEX subtasks_task_idx ON task_has_subtasks(task_id)');
CREATE TABLE groups ( id INT NOT NULL AUTO_INCREMENT, external_id VARCHAR(255) DEFAULT '', name VARCHAR(100) NOT NULL UNIQUE, PRIMARY KEY(id) )
CREATE INDEX categories_project_idx ON project_has_categories(project_id)');
CREATE TABLE task_has_files ( id INT NOT NULL AUTO_INCREMENT, name VARCHAR(50), path VARCHAR(255), is_image TINYINT(1) DEFAULT 0, task_id INT, PRIMARY KEY (id), FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE )
CREATE TABLE `subtasks` ( `id` int(11) NOT NULL AUTO_INCREMENT, `title` varchar(255) NOT NULL, `status` int(11) DEFAULT '0', `time_estimated` float DEFAULT NULL, `time_spent` float DEFAULT NULL, `task_id` int(11) NOT NULL, `user_id` int(11) DEFAULT NULL, `position` int(11) DEFAULT '1', PRIMARY KEY (`id`), KEY `subtasks_task_idx` (`task_id`), CONSTRAINT `subtasks_ibfk_1` FOREIGN KEY (`task_id`) REFERENCES `tasks` (`id`) ON DELETE CASCADE)
select version from schema_version) to stdout;' kanboard` ;
CREATE TABLE subtask_time_tracking ( id INT NOT NULL AUTO_INCREMENT, user_id INT NOT NULL, subtask_id INT NOT NULL, start INT DEFAULT 0, end INT DEFAULT 0, PRIMARY KEY(id), FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE, FOREIGN KEY(subtask_id) REFERENCES task_has_subtasks(id) ON DELETE CASCADE )
CREATE TABLE `project_has_notification_types` ( `id` int(11) NOT NULL AUTO_INCREMENT, `project_id` int(11) NOT NULL, `notification_type` varchar(50) NOT NULL, PRIMARY KEY (`id`), UNIQUE KEY `project_id` (`project_id`,`notification_type`), CONSTRAINT `project_has_notification_types_ibfk_1` FOREIGN KEY (`project_id`) REFERENCES `projects` (`id`) ON DELETE CASCADE)
CREATE TABLE column_has_move_restrictions ( restriction_id INT NOT NULL AUTO_INCREMENT, project_id INT NOT NULL, role_id INT NOT NULL, src_column_id INT NOT NULL, dst_column_id INT NOT NULL, UNIQUE(role_id, src_column_id, dst_column_id), FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, FOREIGN KEY(role_id) REFERENCES project_has_roles(role_id) ON DELETE CASCADE, FOREIGN KEY(src_column_id) REFERENCES columns(id) ON DELETE CASCADE, FOREIGN KEY(dst_column_id) REFERENCES columns(id) ON DELETE CASCADE, PRIMARY KEY(restriction_id) )
CREATE TABLE user_has_metadata ( user_id INTEGER NOT NULL, name VARCHAR(50) NOT NULL, value VARCHAR(255) DEFAULT '', FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE, UNIQUE(user_id, name) )
CREATE TABLE task_has_links ( id SERIAL PRIMARY KEY, link_id INTEGER NOT NULL, task_id INTEGER NOT NULL, opposite_task_id INTEGER NOT NULL, FOREIGN KEY(link_id) REFERENCES links(id) ON DELETE CASCADE, FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE, FOREIGN KEY(opposite_task_id) REFERENCES tasks(id) ON DELETE CASCADE )
SELECT * FROM `users`');
CREATE INDEX files_task_idx ON task_has_files(task_id)');
CREATE TABLE `links` ( `id` int(11) NOT NULL AUTO_INCREMENT, `label` varchar(255) NOT NULL, `opposite_id` int(11) DEFAULT '0', PRIMARY KEY (`id`), UNIQUE KEY `label` (`label`))
CREATE TABLE project_has_groups ( group_id INTEGER NOT NULL, project_id INTEGER NOT NULL, role TEXT NOT NULL, FOREIGN KEY(group_id) REFERENCES groups(id) ON DELETE CASCADE, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, UNIQUE(group_id, project_id) )
CREATE TABLE columns ( id INTEGER PRIMARY KEY, title TEXT NOT NULL, position INTEGER, project_id INTEGER NOT NULL, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, UNIQUE (title, project_id) )
CREATE TABLE `task_has_files` ( `id` int(11) NOT NULL AUTO_INCREMENT, `name` varchar(255) NOT NULL, `path` varchar(255) DEFAULT NULL, `is_image` tinyint(1) DEFAULT '0', `task_id` int(11) NOT NULL, `date` bigint(20) DEFAULT NULL, `user_id` int(11) NOT NULL DEFAULT '0', `size` int(11) NOT NULL DEFAULT '0', PRIMARY KEY (`id`), KEY `files_task_idx` (`task_id`), CONSTRAINT `task_has_files_ibfk_1` FOREIGN KEY (`task_id`) REFERENCES `tasks` (`id`) ON DELETE CASCADE)
CREATE TABLE `swimlanes` ( `id` int(11) NOT NULL AUTO_INCREMENT, `name` varchar(200) NOT NULL, `position` int(11) DEFAULT '1', `is_active` int(11) DEFAULT '1', `project_id` int(11) DEFAULT NULL, `description` text, PRIMARY KEY (`id`), UNIQUE KEY `name` (`name`,`project_id`), KEY `swimlanes_project_idx` (`project_id`), CONSTRAINT `swimlanes_ibfk_1` FOREIGN KEY (`project_id`) REFERENCES `projects` (`id`) ON DELETE CASCADE)
CREATE TABLE links ( id INTEGER PRIMARY KEY, label TEXT NOT NULL, opposite_id INTEGER DEFAULT 0, UNIQUE(label) )
CREATE INDEX transitions_user_index ON transitions(user_id)
CREATE TABLE settings ( `option` VARCHAR(100) PRIMARY KEY, `value` VARCHAR(255) DEFAULT '' )
SELECT * FROM users');
CREATE TABLE swimlanes ( id SERIAL PRIMARY KEY, name VARCHAR(200) NOT NULL, position INTEGER DEFAULT 1, is_active BOOLEAN DEFAULT '1', project_id INTEGER, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, UNIQUE (name, project_id) )
CREATE TABLE project_has_roles ( role_id SERIAL PRIMARY KEY, role VARCHAR(255) NOT NULL, project_id INTEGER NOT NULL, UNIQUE(project_id, role), FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE )
CREATE TABLE subtask_has_events ( id SERIAL PRIMARY KEY, date_creation INTEGER NOT NULL, event_name VARCHAR(50) NOT NULL, creator_id INTEGER, project_id INTEGER, subtask_id INTEGER, task_id INTEGER, data TEXT, FOREIGN KEY(creator_id) REFERENCES users(id) ON DELETE CASCADE, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, FOREIGN KEY(subtask_id) REFERENCES task_has_subtasks(id) ON DELETE CASCADE, FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE )
CREATE TABLE project_has_categories ( id INT NOT NULL AUTO_INCREMENT, name VARCHAR(255), project_id INT, PRIMARY KEY (id), UNIQUE KEY `idx_project_category` (project_id, name), FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE )
CREATE INDEX last_logins_user_idx ON last_logins(user_id)');
CREATE TABLE transitions ( `id` INT NOT NULL AUTO_INCREMENT, `user_id` INT NOT NULL, `project_id` INT NOT NULL, `task_id` INT NOT NULL, `src_column_id` INT NOT NULL, `dst_column_id` INT NOT NULL, `date` INT NOT NULL, `time_spent` INT DEFAULT 0, FOREIGN KEY(src_column_id) REFERENCES columns(id) ON DELETE CASCADE, FOREIGN KEY(dst_column_id) REFERENCES columns(id) ON DELETE CASCADE, FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE, PRIMARY KEY(id) )
CREATE INDEX transitions_project_index ON transitions(project_id)
CREATE TABLE `project_has_metadata` ( `project_id` int(11) NOT NULL, `name` varchar(50) NOT NULL, `value` varchar(255) DEFAULT '', `changed_by` int(11) NOT NULL DEFAULT '0', `changed_on` int(11) NOT NULL DEFAULT '0', UNIQUE KEY `project_id` (`project_id`,`name`), CONSTRAINT `project_has_metadata_ibfk_1` FOREIGN KEY (`project_id`) REFERENCES `projects` (`id`) ON DELETE CASCADE)
CREATE TABLE project_has_groups ( group_id INTEGER NOT NULL, project_id INTEGER NOT NULL, role VARCHAR(25) NOT NULL, FOREIGN KEY(group_id) REFERENCES groups(id) ON DELETE CASCADE, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, UNIQUE(group_id, project_id) )
CREATE TABLE swimlanes ( id INTEGER PRIMARY KEY, name TEXT NOT NULL, position INTEGER DEFAULT 1, is_active INTEGER DEFAULT 1, project_id INTEGER NOT NULL, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, UNIQUE (name, project_id) )
CREATE TABLE columns ( id INT NOT NULL AUTO_INCREMENT, title VARCHAR(255), position INT NOT NULL, project_id INT NOT NULL, task_limit INT DEFAULT '0', UNIQUE KEY `idx_title_project` (title, project_id), PRIMARY KEY (id), FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE )
SELECT * FROM project_has_users');
CREATE TABLE user_has_metadata ( user_id INTEGER NOT NULL, name TEXT NOT NULL, value TEXT DEFAULT '', FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE, UNIQUE(user_id, name) )
CREATE TABLE project_has_metadata ( project_id INTEGER NOT NULL, name VARCHAR(50) NOT NULL, value VARCHAR(255) DEFAULT '', FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, UNIQUE(project_id, name) )
CREATE TABLE `project_activities` ( `id` int(11) NOT NULL AUTO_INCREMENT, `date_creation` bigint(20) DEFAULT NULL, `event_name` varchar(50) NOT NULL, `creator_id` int(11) DEFAULT NULL, `project_id` int(11) DEFAULT NULL, `task_id` int(11) DEFAULT NULL, `data` text, PRIMARY KEY (`id`), KEY `creator_id` (`creator_id`), KEY `project_id` (`project_id`), KEY `task_id` (`task_id`), CONSTRAINT `project_activities_ibfk_1` FOREIGN KEY (`creator_id`) REFERENCES `users` (`id`) ON DELETE CASCADE, CONSTRAINT `project_activities_ibfk_2` FOREIGN KEY (`project_id`) REFERENCES `projects` (`id`) ON DELETE CASCADE, CONSTRAINT `project_activities_ibfk_3` FOREIGN KEY (`task_id`) REFERENCES `tasks` (`id`) ON DELETE CASCADE)
INSERT INTO schema_version VALUES ('$$mysql_version')
CREATE INDEX tasks_reference_idx ON tasks(reference)');
CREATE TABLE task_has_subtasks ( id SERIAL PRIMARY KEY, title VARCHAR(255), status SMALLINT DEFAULT 0, time_estimated INTEGER DEFAULT 0, time_spent INTEGER DEFAULT 0, task_id INTEGER NOT NULL, user_id INTEGER, FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE )
CREATE TABLE comment_has_events ( id INT NOT NULL AUTO_INCREMENT, date_creation INT NOT NULL, event_name TEXT NOT NULL, creator_id INT, project_id INT, comment_id INT, task_id INT, data TEXT, FOREIGN KEY(creator_id) REFERENCES users(id) ON DELETE CASCADE, FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE, FOREIGN KEY(comment_id) REFERENCES comments(id) ON DELETE CASCADE, FOREIGN KEY(task_id) REFERENCES tasks(id) ON DELETE CASCADE, PRIMARY KEY (id) )
CREATE TABLE groups ( id INTEGER PRIMARY KEY, external_id TEXT DEFAULT '', name TEXT NOCASE NOT NULL UNIQUE )
SELECT id FROM projects WHERE is_private='1'
CREATE TABLE settings ( option VARCHAR(100) PRIMARY KEY, value VARCHAR(255) DEFAULT '' )
