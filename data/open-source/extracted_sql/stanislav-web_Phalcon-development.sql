CREATE TABLE `currency` ( `id` tinyint(3) unsigned NOT NULL AUTO_INCREMENT COMMENT 'Currency ID', `code` char(3) NOT NULL COMMENT 'Currency Code', `name` varchar(45) NOT NULL, `symbol` varchar(4) NOT NULL, PRIMARY KEY (`id`), UNIQUE KEY `uni_code` (`code`) COMMENT 'Unique code')
CREATE TABLE `xmail_stats` ( `id` int(11) unsigned NOT NULL AUTO_INCREMENT COMMENT 'Record ID', `list_id` int(11) unsigned DEFAULT NULL COMMENT 'Mail list', `subject` varchar(255) NOT NULL DEFAULT '' COMMENT 'Subscriber name', `status` enum('ok','pending','failed','abort') NOT NULL DEFAULT 'pending' COMMENT 'Mailing status', `date_start` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'Mailing start date', `date_finish` datetime DEFAULT NULL COMMENT 'Mailing finish date', PRIMARY KEY (`id`), KEY `idx_status` (`status`), KEY `idx_date_start` (`date_start`), KEY `idx_date_finish` (`date_finish`), KEY `idx_status_date_start` (`status`,`date_start`), KEY `idx_status_date_finish` (`status`,`date_finish`), KEY `fk_list_id` (`list_id`), CONSTRAINT `fk_list_id` FOREIGN KEY (`list_id`) REFERENCES `xmail_lists` (`id`) ON DELETE CASCADE ON UPDATE CASCADE)
CREATE TABLE `xmail_lists` ( `id` int(11) unsigned NOT NULL AUTO_INCREMENT COMMENT 'List ID', `subject` varchar(255) NOT NULL DEFAULT '' COMMENT 'List subject', `message` text COMMENT 'List message', `date_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'Default create date', PRIMARY KEY (`id`))
CREATE TABLE `xmail_subscribers` ( `id` int(11) unsigned NOT NULL AUTO_INCREMENT COMMENT 'Subscriber ID', `name` varchar(255) NOT NULL DEFAULT '' COMMENT 'Subscriber name', `email` varchar(255) NOT NULL DEFAULT '' COMMENT 'Subscriber email', `state` enum('disabled','active','moderated') NOT NULL DEFAULT 'disabled' COMMENT 'Activity state, 0 - disabled, 1 - active, 2 - moderated', `checked` tinyint(1) unsigned NOT NULL DEFAULT '0', `date_registration` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'Default subscriber reg date', PRIMARY KEY (`id`), UNIQUE KEY `uni_email` (`email`), KEY `idx_state` (`state`), KEY `idx_checked` (`checked`) USING BTREE)
SELECT MAX(rgt) FROM categories t);
CREATE TABLE `pages` ( `id` tinyint(3) unsigned NOT NULL AUTO_INCREMENT COMMENT 'ID', `title` varchar(255) NOT NULL DEFAULT '' COMMENT 'Title of page', `content` text NOT NULL COMMENT 'HTML content', `alias` varchar(32) NOT NULL DEFAULT '' COMMENT 'URL slug', `date_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'Create date', `date_update` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'Update date', PRIMARY KEY (`id`), FULLTEXT KEY `ful_content` (`content`))
CREATE TABLE `engines` ( `id` tinyint(2) unsigned NOT NULL AUTO_INCREMENT COMMENT 'Engine ID', `name` varchar(45) NOT NULL COMMENT 'Engine name', `description` varchar(512) NOT NULL COMMENT 'Engine description', `host` varchar(45) DEFAULT NULL COMMENT 'identity host name', `code` char(3) NOT NULL COMMENT 'Engine short code', `logo` varchar(255) NOT NULL DEFAULT '' COMMENT 'Engine logo', `currency_id` tinyint(3) unsigned DEFAULT NULL COMMENT 'Relation to `currency` table', `date_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP, `date_update` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, PRIMARY KEY (`id`), UNIQUE KEY `uni_code` (`code`) COMMENT 'Unique value of code', UNIQUE KEY `uni_host` (`host`), KEY `fk_currency_id` (`currency_id`), CONSTRAINT `fk_currency_id` FOREIGN KEY (`currency_id`) REFERENCES `currency` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION)
CREATE TABLE `user_roles` ( `id` tinyint(1) unsigned NOT NULL, `role` varchar(45) DEFAULT NULL, PRIMARY KEY (`id`))
CREATE TABLE `xmail_active_log` ( `id` int(11) unsigned NOT NULL AUTO_INCREMENT COMMENT 'ID', `subscriber_id` int(11) unsigned DEFAULT NULL COMMENT 'Subscriber ID', `list_id` int(11) unsigned DEFAULT NULL COMMENT 'Mail list ID', `date_sent` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'Send date', PRIMARY KEY (`id`), KEY `idx_date_sent` (`date_sent`), KEY `fk_subscriber_id` (`subscriber_id`), KEY `fk_subscribers_list_id` (`list_id`), CONSTRAINT `fk_subscriber_id` FOREIGN KEY (`subscriber_id`) REFERENCES `xmail_subscribers` (`id`) ON DELETE CASCADE ON UPDATE CASCADE, CONSTRAINT `fk_subscribers_list_id` FOREIGN KEY (`list_id`) REFERENCES `xmail_lists` (`id`) ON DELETE CASCADE ON UPDATE CASCADE)
CREATE TABLE `item_attributes` ( `id` tinyint(3) unsigned NOT NULL AUTO_INCREMENT, `name` varchar(64) NOT NULL DEFAULT '' COMMENT 'Item attributes table', `translate` varchar(32) DEFAULT NULL, `integer` tinyint(1) unsigned NOT NULL DEFAULT '0', `decimal` tinyint(1) unsigned NOT NULL DEFAULT '0', `varchar` tinyint(1) unsigned NOT NULL DEFAULT '0', `date` tinyint(1) unsigned NOT NULL DEFAULT '0', `date_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP, `date_update` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, PRIMARY KEY (`id`), KEY `idx_integer` (`integer`), KEY `idx_decimal` (`decimal`), KEY `idx_varchar` (`varchar`), KEY `idx_date` (`date`))
CREATE TABLE `item_attribute_values` ( `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT, `item_attribute_id` tinyint(1) unsigned NOT NULL, `item_id` int(11) unsigned NOT NULL, `value` varchar(255) NOT NULL DEFAULT '', `date_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP, `date_update` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, PRIMARY KEY (`id`), KEY `item_id` (`item_id`), KEY `item_attribute_id` (`item_attribute_id`), CONSTRAINT `item_attribute_values_ibfk_1` FOREIGN KEY (`item_id`) REFERENCES `items` (`id`) ON DELETE CASCADE ON UPDATE CASCADE, CONSTRAINT `item_attribute_values_ibfk_2` FOREIGN KEY (`item_attribute_id`) REFERENCES `item_attributes` (`id`) ON DELETE CASCADE ON UPDATE CASCADE)
CREATE TABLE `user_access` ( `user_id` int(11) unsigned NOT NULL, `token` varchar(255) NOT NULL, `expire_date` datetime NOT NULL, PRIMARY KEY (`user_id`), CONSTRAINT `user_access_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE ON UPDATE CASCADE)
SELECT MAX(rgt) FROM item_attributes t);
CREATE TABLE `items` ( `id` int(11) unsigned NOT NULL AUTO_INCREMENT, `name` varchar(255) NOT NULL DEFAULT '', `label` varchar(255) NOT NULL DEFAULT '', `description` text NOT NULL, `images` varchar(512) NOT NULL, `previews` varchar(512) NOT NULL, `is_published` tinyint(1) unsigned DEFAULT '0', `is_moderated` tinyint(1) unsigned DEFAULT '0', `in_storage` int(11) unsigned DEFAULT '0', `user_id` int(11) unsigned DEFAULT NULL, `date_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP, `date_update` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, `date_removal` datetime DEFAULT NULL, PRIMARY KEY (`id`), KEY `idx_items_user_id` (`user_id`), KEY `idx_published` (`is_published`), KEY `idx_moderated` (`is_moderated`), CONSTRAINT `fk_items_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE ON UPDATE CASCADE)
CREATE TABLE `banners` ( `id` tinyint(2) unsigned NOT NULL AUTO_INCREMENT COMMENT 'Banner ID', `engine_id` tinyint(2) unsigned NOT NULL COMMENT 'Engine ID rel', `image` varchar(255) NOT NULL COMMENT 'Image', `link` varchar(255) NOT NULL DEFAULT '' COMMENT 'Link', `description` varchar(255) NOT NULL, `date_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP, `date_update` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, PRIMARY KEY (`id`), KEY `fk_banner_engine` (`engine_id`), KEY `idx_engine_id` (`image`), CONSTRAINT `fk_banner_engine` FOREIGN KEY (`engine_id`) REFERENCES `engines` (`id`) ON DELETE CASCADE ON UPDATE CASCADE)
CREATE TABLE `logs` ( `id` int(10) unsigned NOT NULL AUTO_INCREMENT, `name` varchar(32) DEFAULT NULL, `type` tinyint(3) unsigned NOT NULL, `content` text NOT NULL, `created_at` int(11) unsigned NOT NULL, PRIMARY KEY (`id`))
CREATE TABLE `errors` ( `id` tinyint(3) unsigned NOT NULL AUTO_INCREMENT COMMENT 'Error ID', `code` varchar(65) NOT NULL DEFAULT '' COMMENT 'Error Code', `description` text NOT NULL COMMENT 'Description', PRIMARY KEY (`id`), UNIQUE KEY `uni_code` (`code`) COMMENT 'Unique code')
CREATE TABLE `category_items` ( `category_id` tinyint(3) unsigned DEFAULT NULL, `item_id` int(10) unsigned DEFAULT NULL, KEY `fk_category_items_idx` (`category_id`), KEY `fk_items_category_idx` (`item_id`), CONSTRAINT `fk_category_items` FOREIGN KEY (`category_id`) REFERENCES `categories` (`id`) ON DELETE CASCADE ON UPDATE CASCADE, CONSTRAINT `fk_items_category` FOREIGN KEY (`item_id`) REFERENCES `items` (`id`) ON DELETE CASCADE ON UPDATE CASCADE)
CREATE TABLE `xmail_queue` ( `pid` int(11) unsigned DEFAULT NULL COMMENT 'Queue ID', `storage` varchar(32) NOT NULL DEFAULT '' COMMENT 'Used storage adapter', `broker` varchar(32) NOT NULL DEFAULT '' COMMENT 'Used queue adapter', `mail` varchar(32) NOT NULL DEFAULT '' COMMENT 'Used mail adapter', `priority` tinyint(2) unsigned DEFAULT '0' COMMENT 'Queue priority', `date_activation` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'Activation date', UNIQUE KEY `pid` (`pid`,`storage`,`broker`,`mail`), KEY `idx_adapters` (`storage`,`broker`,`mail`), KEY `idx_priority` (`priority`))
CREATE TABLE `subscribers` ( `id` int(11) unsigned NOT NULL AUTO_INCREMENT COMMENT 'Subscriber ID', `email` varchar(40) NOT NULL COMMENT 'Email', `status` tinyint(1) NOT NULL DEFAULT '0' COMMENT 'Subscribe status', `date_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP, `date_update` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, PRIMARY KEY (`id`), UNIQUE KEY `uni_email` (`email`), KEY `idx_status_email` (`email`,`status`))
