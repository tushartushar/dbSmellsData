CREATE TABLE `ConfigItems` ( `id_item` int(10) unsigned NOT NULL AUTO_INCREMENT, `fk_id_class` int(10) unsigned NOT NULL DEFAULT '0', PRIMARY KEY (`id_item`), KEY `fk_id_class` (`fk_id_class`), CONSTRAINT `ConfigItems_ibfk_1` FOREIGN KEY (`fk_id_class`) REFERENCES `ConfigClasses` (`id_class`) ON DELETE CASCADE ON UPDATE CASCADE)
CREATE TABLE `ItemLinks` ( `fk_id_item` int(10) unsigned NOT NULL DEFAULT '0', `fk_item_linked2` int(10) unsigned NOT NULL DEFAULT '0', `fk_id_attr` int(10) unsigned NOT NULL DEFAULT '0', `cust_order` int(11) NOT NULL DEFAULT '0', PRIMARY KEY (`fk_id_item`,`fk_item_linked2`,`fk_id_attr`), KEY `fk_item_linked2` (`fk_item_linked2`), KEY `fk_id_attr` (`fk_id_attr`), CONSTRAINT `ItemLinks_ibfk_1` FOREIGN KEY (`fk_id_item`) REFERENCES `ConfigItems` (`id_item`) ON DELETE CASCADE ON UPDATE CASCADE, CONSTRAINT `ItemLinks_ibfk_2` FOREIGN KEY (`fk_item_linked2`) REFERENCES `ConfigItems` (`id_item`) ON DELETE CASCADE ON UPDATE CASCADE, CONSTRAINT `ItemLinks_ibfk_3` FOREIGN KEY (`fk_id_attr`) REFERENCES `ConfigAttrs` (`id_attr`) ON DELETE CASCADE ON UPDATE CASCADE)
UPDATE test_instances set plop= WHERE is_master=1  WHERE is_master=1
CREATE TABLE `ConfigClasses` ( `id_class` int(10) unsigned NOT NULL AUTO_INCREMENT, `config_class` varchar(50) NOT NULL DEFAULT '', `friendly_name` varchar(80) NOT NULL, `nav_visible` enum('yes','no') NOT NULL DEFAULT 'yes', `ordering` int(11) NOT NULL DEFAULT '0', `grouping` varchar(30) NOT NULL, `nav_links` varchar(512) NOT NULL, `nav_privs` enum('user','admin') NOT NULL DEFAULT 'admin', `class_type` enum('global','monitor','collector') NOT NULL DEFAULT 'global', `out_file` varchar(50) DEFAULT NULL, `nagios_object` varchar(50) DEFAULT NULL, PRIMARY KEY (`id_class`))
CREATE TABLE `ConfigValues` ( `attr_value` varchar(1024) DEFAULT NULL, `fk_id_attr` int(10) unsigned NOT NULL DEFAULT '0', `fk_id_item` int(10) unsigned NOT NULL DEFAULT '0', PRIMARY KEY (`fk_id_attr`,`fk_id_item`), KEY `fk_id_item` (`fk_id_item`), CONSTRAINT `ConfigValues_ibfk_1` FOREIGN KEY (`fk_id_attr`) REFERENCES `ConfigAttrs` (`id_attr`) ON DELETE CASCADE ON UPDATE CASCADE, CONSTRAINT `ConfigValues_ibfk_2` FOREIGN KEY (`fk_id_item`) REFERENCES `ConfigItems` (`id_item`) ON DELETE CASCADE ON UPDATE CASCADE)
UPDATE test_instances set plop=master  WHERE is_master=1
CREATE TABLE `History` ( `id_hist` int(10) unsigned NOT NULL AUTO_INCREMENT, `timestamp` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, `user_str` varchar(250) NOT NULL, `action` enum('created','added','assigned','unassigned','modified','edited','removed','general','module') NOT NULL, `attr_name` varchar(80) NOT NULL, `attr_value` varchar(1024) DEFAULT NULL, `fk_id_item` int(10) unsigned DEFAULT NULL, PRIMARY KEY (`id_hist`), KEY `fk_id_item` (`fk_id_item`), CONSTRAINT `History_ibfk_1` FOREIGN KEY (`fk_id_item`) REFERENCES `ConfigItems` (`id_item`) ON DELETE SET NULL ON UPDATE CASCADE)
